(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;j=function(b,c,d,e){return new a(b,c,d,e)},"undefined"!=typeof module&&null!==module&&null!=module.exports&&(module.exports=j),"function"==typeof define&&define.amd?define([],function(){return j}):(H="undefined"!=typeof exports&&null!==exports?exports:this,H.chroma=j),j.color=function(b,c,d,e){return new a(b,c,d,e)},j.hsl=function(b,c,d,e){return new a(b,c,d,e,"hsl")},j.hsv=function(b,c,d,e){return new a(b,c,d,e,"hsv")},j.rgb=function(b,c,d,e){return new a(b,c,d,e,"rgb")},j.hex=function(b){return new a(b)},j.css=function(b){return new a(b)},j.lab=function(b,c,d){return new a(b,c,d,"lab")},j.lch=function(b,c,d){return new a(b,c,d,"lch")},j.hsi=function(b,c,d){return new a(b,c,d,"hsi")},j.gl=function(b,c,d,e){return new a(255*b,255*c,255*d,e,"gl")},j.interpolate=function(b,c,d,e){return null==b||null==c?"#000":("string"===I(b)&&(b=new a(b)),"string"===I(c)&&(c=new a(c)),b.interpolate(d,c,e))},j.mix=j.interpolate,j.contrast=function(b,c){var d,e;return"string"===I(b)&&(b=new a(b)),"string"===I(c)&&(c=new a(c)),d=b.luminance(),e=c.luminance(),d>e?(d+.05)/(e+.05):(e+.05)/(d+.05)},j.luminance=function(a){return j(a).luminance()},j._Color=a,a=function(){function a(){var a,b,c,d,e,f,g,h,i,j,l,m,n,s,u,v;for(e=this,c=[],j=0,l=arguments.length;l>j;j++)b=arguments[j],null!=b&&c.push(b);if(0===c.length)m=[255,0,255,1,"rgb"],g=m[0],h=m[1],i=m[2],a=m[3],d=m[4];else if("array"===I(c[0])){if(3===c[0].length)n=c[0],g=n[0],h=n[1],i=n[2],a=1;else{if(4!==c[0].length)throw"unknown input argument";s=c[0],g=s[0],h=s[1],i=s[2],a=s[3]}d=null!=(u=c[1])?u:"rgb"}else"string"===I(c[0])?(g=c[0],d="hex"):"object"===I(c[0])?(v=c[0]._rgb,g=v[0],h=v[1],i=v[2],a=v[3],d="rgb"):c.length>=3&&(g=c[0],h=c[1],i=c[2]);3===c.length?(d="rgb",a=1):4===c.length?"string"===I(c[3])?(d=c[3],a=1):"number"===I(c[3])&&(d="rgb",a=c[3]):5===c.length&&(a=c[3],d=c[4]),null==a&&(a=1),"rgb"===d?e._rgb=[g,h,i,a]:"gl"===d?e._rgb=[255*g,255*h,255*i,a]:"hsl"===d?(e._rgb=q(g,h,i),e._rgb[3]=a):"hsv"===d?(e._rgb=r(g,h,i),e._rgb[3]=a):"hex"===d?e._rgb=o(g):"lab"===d?(e._rgb=t(g,h,i),e._rgb[3]=a):"lch"===d?(e._rgb=w(g,h,i),e._rgb[3]=a):"hsi"===d&&(e._rgb=p(g,h,i),e._rgb[3]=a),f=k(e._rgb)}return a.prototype.rgb=function(){return this._rgb.slice(0,3)},a.prototype.rgba=function(){return this._rgb},a.prototype.hex=function(){return A(this._rgb)},a.prototype.toString=function(){return this.name()},a.prototype.hsl=function(){return C(this._rgb)},a.prototype.hsv=function(){return D(this._rgb)},a.prototype.lab=function(){return E(this._rgb)},a.prototype.lch=function(){return F(this._rgb)},a.prototype.hsi=function(){return B(this._rgb)},a.prototype.gl=function(){return[this._rgb[0]/255,this._rgb[1]/255,this._rgb[2]/255,this._rgb[3]]},a.prototype.luminance=function(){return y(this._rgb)},a.prototype.name=function(){var a,b;a=this.hex();for(b in j.colors)if(a===j.colors[b])return b;return a},a.prototype.alpha=function(a){return arguments.length?(this._rgb[3]=a,this):this._rgb[3]},a.prototype.css=function(a){var b,c,d,e;return null==a&&(a="rgb"),c=this,d=c._rgb,3===a.length&&d[3]<1&&(a+="a"),"rgb"===a?a+"("+d.slice(0,3).map(Math.round).join(",")+")":"rgba"===a?a+"("+d.slice(0,3).map(Math.round).join(",")+","+d[3]+")":"hsl"===a||"hsla"===a?(b=c.hsl(),e=function(a){return Math.round(100*a)/100},b[0]=e(b[0]),b[1]=e(100*b[1])+"%",b[2]=e(100*b[2])+"%",4===a.length&&(b[3]=d[3]),a+"("+b.join(",")+")"):void 0},a.prototype.interpolate=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(l=this,null==d&&(d="rgb"),"string"===I(c)&&(c=new a(c)),"hsl"===d||"hsv"===d||"lch"===d||"hsi"===d)"hsl"===d?(q=l.hsl(),r=c.hsl()):"hsv"===d?(q=l.hsv(),r=c.hsv()):"hsi"===d?(q=l.hsi(),r=c.hsi()):"lch"===d&&(q=l.lch(),r=c.lch()),"h"===d.substr(0,1)?(g=q[0],o=q[1],j=q[2],h=r[0],p=r[1],k=r[2]):(j=q[0],o=q[1],g=q[2],k=r[0],p=r[1],h=r[2]),isNaN(g)||isNaN(h)?isNaN(g)?isNaN(h)?f=Number.NaN:(f=h,1!==j&&0!==j||"hsv"===d||(n=p)):(f=g,1!==k&&0!==k||"hsv"===d||(n=o)):(e=h>g&&h-g>180?h-(g+360):g>h&&g-h>180?h+360-g:h-g,f=g+b*e),null==n&&(n=o+b*(p-o)),i=j+b*(k-j),m="h"===d.substr(0,1)?new a(f,n,i,d):new a(i,n,f,d);else if("rgb"===d)q=l._rgb,r=c._rgb,m=new a(q[0]+b*(r[0]-q[0]),q[1]+b*(r[1]-q[1]),q[2]+b*(r[2]-q[2]),d);else{if("lab"!==d)throw"color mode "+d+" is not supported";q=l.lab(),r=c.lab(),m=new a(q[0]+b*(r[0]-q[0]),q[1]+b*(r[1]-q[1]),q[2]+b*(r[2]-q[2]),d)}return m.alpha(l.alpha()+b*(c.alpha()-l.alpha())),m},a.prototype.premultiply=function(){var a,b;return b=this.rgb(),a=this.alpha(),j(b[0]*a,b[1]*a,b[2]*a,a)},a.prototype.darken=function(a){var b,c;return null==a&&(a=20),c=this,b=c.lch(),b[0]-=a,j.lch(b).alpha(c.alpha())},a.prototype.darker=function(a){return this.darken(a)},a.prototype.brighten=function(a){return null==a&&(a=20),this.darken(-a)},a.prototype.brighter=function(a){return this.brighten(a)},a.prototype.saturate=function(a){var b,c;return null==a&&(a=20),c=this,b=c.lch(),b[1]+=a,j.lch(b).alpha(c.alpha())},a.prototype.desaturate=function(a){return null==a&&(a=20),this.saturate(-a)},a}(),k=function(a){var b;for(b in a)3>b?(a[b]<0&&(a[b]=0),a[b]>255&&(a[b]=255)):3===b&&(a[b]<0&&(a[b]=0),a[b]>1&&(a[b]=1));return a},n=function(a){var b,c,d,e,f,g,h,i;if(a=a.toLowerCase(),null!=j.colors&&j.colors[a])return o(j.colors[a]);if(d=a.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(e=d.slice(1,4),c=f=0;2>=f;c=++f)e[c]=+e[c];e[3]=1}else if(d=a.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(e=d.slice(1,5),c=g=0;3>=g;c=++g)e[c]=+e[c];else if(d=a.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(e=d.slice(1,4),c=h=0;2>=h;c=++h)e[c]=Math.round(2.55*e[c]);e[3]=1}else if(d=a.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(e=d.slice(1,5),c=i=0;2>=i;c=++i)e[c]=Math.round(2.55*e[c]);e[3]=+e[3]}else(d=a.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(b=d.slice(1,4),b[1]*=.01,b[2]*=.01,e=q(b),e[3]=1):(d=a.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(b=d.slice(1,4),b[1]*=.01,b[2]*=.01,e=q(b),e[3]=+d[4]);return e},o=function(a){var b,c,d,e,f,g;if(a.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(4===a.length||7===a.length)&&(a=a.substr(1)),3===a.length&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),g=parseInt(a,16),e=g>>16,d=g>>8&255,c=255&g,[e,d,c,1];if(a.match(/^#?([A-Fa-f0-9]{8})$/))return 9===a.length&&(a=a.substr(1)),g=parseInt(a,16),e=g>>24&255,d=g>>16&255,c=g>>8&255,b=255&g,[e,d,c,b];if(f=n(a))return f;throw"unknown color: "+a},p=function(a,b,e){var f,g,h,i;return i=J(arguments),a=i[0],b=i[1],e=i[2],a/=360,1/3>a?(f=(1-b)/3,h=(1+b*m(d*a)/m(c-d*a))/3,g=1-(f+h)):2/3>a?(a-=1/3,h=(1-b)/3,g=(1+b*m(d*a)/m(c-d*a))/3,f=1-(h+g)):(a-=2/3,g=(1-b)/3,f=(1+b*m(d*a)/m(c-d*a))/3,h=1-(g+f)),h=x(e*h*3),g=x(e*g*3),f=x(e*f*3),[255*h,255*g,255*f]},q=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;if(m=J(arguments),d=m[0],h=m[1],f=m[2],0===h)g=c=a=255*f;else{for(k=[0,0,0],b=[0,0,0],j=.5>f?f*(1+h):f+h-f*h,i=2*f-j,d/=360,k[0]=d+1/3,k[1]=d,k[2]=d-1/3,e=l=0;2>=l;e=++l)k[e]<0&&(k[e]+=1),k[e]>1&&(k[e]-=1),b[e]=6*k[e]<1?i+6*(j-i)*k[e]:2*k[e]<1?j:3*k[e]<2?i+(j-i)*(2/3-k[e])*6:i;n=[Math.round(255*b[0]),Math.round(255*b[1]),Math.round(255*b[2])],g=n[0],c=n[1],a=n[2]}return[g,c,a]},r=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(l=J(arguments),d=l[0],i=l[1],k=l[2],k*=255,0===i)h=c=a=k;else switch(360===d&&(d=0),d>360&&(d-=360),0>d&&(d+=360),d/=60,e=Math.floor(d),b=d-e,f=k*(1-i),g=k*(1-i*b),j=k*(1-i*(1-b)),e){case 0:m=[k,j,f],h=m[0],c=m[1],a=m[2];break;case 1:n=[g,k,f],h=n[0],c=n[1],a=n[2];break;case 2:o=[f,k,j],h=o[0],c=o[1],a=o[2];break;case 3:p=[f,g,k],h=p[0],c=p[1],a=p[2];break;case 4:q=[j,f,k],h=q[0],c=q[1],a=q[2];break;case 5:r=[k,f,g],h=r[0],c=r[1],a=r[2]}return h=Math.round(h),c=Math.round(c),a=Math.round(a),[h,c,a]},b=18,e=.95047,f=1,g=1.08883,s=function(){var a,b,c,d,e,f;return f=J(arguments),e=f[0],a=f[1],b=f[2],c=Math.sqrt(a*a+b*b),d=Math.atan2(b,a)/Math.PI*180,[e,c,d]},t=function(a,b,c){var d,h,i,j,k,l,m;return void 0!==a&&3===a.length&&(l=a,a=l[0],b=l[1],c=l[2]),void 0!==a&&3===a.length&&(m=a,a=m[0],b=m[1],c=m[2]),j=(a+16)/116,i=j+b/500,k=j-c/200,i=u(i)*e,j=u(j)*f,k=u(k)*g,h=L(3.2404542*i-1.5371385*j-.4985314*k),d=L(-.969266*i+1.8760108*j+.041556*k),c=L(.0556434*i-.2040259*j+1.0572252*k),[x(h,0,255),x(d,0,255),x(c,0,255),1]},u=function(a){return a>.206893034?a*a*a:(a-4/29)/7.787037},L=function(a){return Math.round(255*(.00304>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055))},v=function(){var a,b,c,d;return d=J(arguments),c=d[0],a=d[1],b=d[2],b=b*Math.PI/180,[c,Math.cos(b)*a,Math.sin(b)*a]},w=function(a,b,c){var d,e,f,g,h,i,j;return i=v(a,b,c),d=i[0],e=i[1],f=i[2],j=t(d,e,f),h=j[0],g=j[1],f=j[2],[x(h,0,255),x(g,0,255),x(f,0,255)]},y=function(a,b,c){var d;return d=J(arguments),a=d[0],b=d[1],c=d[2],a=z(a),b=z(b),c=z(c),.2126*a+.7152*b+.0722*c},z=function(a){return a/=255,.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},A=function(){var a,b,c,d,e,f;return f=J(arguments),c=f[0],b=f[1],a=f[2],e=c<<16|b<<8|a,d="000000"+e.toString(16),"#"+d.substr(d.length-6)},B=function(){var a,b,c,d,e,f,g,h,i;return i=J(arguments),g=i[0],c=i[1],b=i[2],a=2*Math.PI,g/=255,c/=255,b/=255,f=Math.min(g,c,b),e=(g+c+b)/3,h=1-f/e,0===h?d=0:(d=(g-c+(g-b))/2,d/=Math.sqrt((g-c)*(g-c)+(g-b)*(c-b)),d=Math.acos(d),b>c&&(d=a-d),d/=a),[360*d,h,e]},C=function(a,b,c){var d,e,f,g,h,i;return void 0!==a&&a.length>=3&&(i=a,a=i[0],b=i[1],c=i[2]),a/=255,b/=255,c/=255,g=Math.min(a,b,c),f=Math.max(a,b,c),e=(f+g)/2,f===g?(h=0,d=Number.NaN):h=.5>e?(f-g)/(f+g):(f-g)/(2-f-g),a===f?d=(b-c)/(f-g):b===f?d=2+(c-a)/(f-g):c===f&&(d=4+(a-b)/(f-g)),d*=60,0>d&&(d+=360),[d,h,e]},D=function(){var a,b,c,d,e,f,g,h,i,j;return j=J(arguments),g=j[0],c=j[1],a=j[2],f=Math.min(g,c,a),e=Math.max(g,c,a),b=e-f,i=e/255,0===e?(d=Number.NaN,h=0):(h=b/e,g===e&&(d=(c-a)/b),c===e&&(d=2+(a-g)/b),a===e&&(d=4+(g-c)/b),d*=60,0>d&&(d+=360)),[d,h,i]},E=function(){var a,b,c,d,h,i,j;return j=J(arguments),c=j[0],b=j[1],a=j[2],c=G(c),b=G(b),a=G(a),d=K((.4124564*c+.3575761*b+.1804375*a)/e),h=K((.2126729*c+.7151522*b+.072175*a)/f),i=K((.0193339*c+.119192*b+.9503041*a)/g),[116*h-16,500*(d-h),200*(h-i)]},G=function(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)},K=function(a){return a>.008856?Math.pow(a,1/3):7.787037*a+4/29},F=function(){var a,b,c,d,e,f,g;return f=J(arguments),e=f[0],c=f[1],b=f[2],g=E(e,c,b),d=g[0],a=g[1],b=g[2],s(d,a,b)},j.scale=function(a,b){var c,d,e,f,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return s="rgb",t=j("#ccc"),x=0,p=!1,o=[0,1],m=[],v=!1,w=[],r=0,q=1,n=!1,u=0,l={},h=function(a,b){var c,d,e,f,h,i,k;if(null==a&&(a=["#ddd","#222"]),null!=a&&"string"===I(a)&&null!=(null!=(h=j.brewer)?h[a]:void 0)&&(a=j.brewer[a]),"array"===I(a)){for(a=a.slice(0),c=e=0,i=a.length-1;i>=0?i>=e:e>=i;c=i>=0?++e:--e)d=a[c],"string"===I(d)&&(a[c]=j(d));if(null!=b)w=b;else for(w=[],c=f=0,k=a.length-1;k>=0?k>=f:f>=k;c=k>=0?++f:--f)w.push(c/(a.length-1))}return g(),m=a},i=function(a){return null==a&&(a=[]),o=a,r=a[0],q=a[a.length-1],g(),u=2===a.length?0:a.length-1},e=function(a){var b,c;if(null!=o){for(c=o.length-1,b=0;c>b&&a>=o[b];)b++;return b-1}return 0},k=function(a){return a},c=function(a){var b,c,d,f,g;return g=a,o.length>2&&(f=o.length-1,b=e(a),d=o[0]+(o[1]-o[0])*(0+.5*x),c=o[f-1]+(o[f]-o[f-1])*(1-.5*x),g=r+(o[b]+.5*(o[b+1]-o[b])-d)/(c-d)*(q-r)),g},f=function(a,b){var c,d,f,g,h,i,n,p,v;if(null==b&&(b=!1),isNaN(a))return t;if(b?n=a:o.length>2?(c=e(a),n=c/(u-1)):(n=f=(a-r)/(q-r),n=Math.min(1,Math.max(0,n))),b||(n=k(n)),h=Math.floor(1e4*n),l[h])d=l[h];else{if("array"===I(m))for(g=p=0,v=w.length-1;v>=0?v>=p:p>=v;g=v>=0?++p:--p){if(i=w[g],i>=n){d=m[g];break}if(n>=i&&g===w.length-1){d=m[g];break}if(n>i&&n<w[g+1]){n=(n-i)/(w[g+1]-i),d=j.interpolate(m[g],m[g+1],n,s);break}}else"function"===I(m)&&(d=m(n));l[h]=d}return d},g=function(){return l={}},h(a,b),d=function(a){var b;return b=f(a),v&&b[v]?b[v]():b},d.domain=function(a,b,c,e){var f;return null==c&&(c="e"),arguments.length?(null!=b&&(f=j.analyze(a,e),a=0===b?[f.min,f.max]:j.limits(f,c,b)),i(a),d):o},d.mode=function(a){return arguments.length?(s=a,g(),d):s},d.range=function(a,b){return h(a,b),d},d.out=function(a){return v=a,d},d.spread=function(a){return arguments.length?(x=a,d):x},d.correctLightness=function(a){return arguments.length?(n=a,g(),k=n?function(a){var b,c,d,e,g,h,i,j,k;for(b=f(0,!0).lab()[0],c=f(1,!0).lab()[0],i=b>c,d=f(a,!0).lab()[0],g=b+(c-b)*a,e=d-g,j=0,k=1,h=20;Math.abs(e)>.01&&h-->0;)!function(){return i&&(e*=-1),0>e?(j=a,a+=.5*(k-a)):(k=a,a+=.5*(j-a)),d=f(a,!0).lab()[0],e=d-g}();return a}:function(a){return a},d):n},d.colors=function(b){var c,e,f,g,h,i;if(null==b&&(b="hex"),a=[],e=[],o.length>2)for(c=f=1,i=o.length;i>=1?i>f:f>i;c=i>=1?++f:--f)e.push(.5*(o[c-1]+o[c]));else e=o;for(g=0,h=e.length;h>g;g++)c=e[g],a.push(d(c)[b]());return a},d},null==(M=j.scales)&&(j.scales={}),j.scales.cool=function(){return j.scale([j.hsl(180,1,.9),j.hsl(250,.7,.4)])},j.scales.hot=function(){return j.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},j.analyze=function(a,b,c){var d,e,f,g,h,i,k;if(f={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==c&&(c=function(){return!0}),d=function(a){null==a||isNaN(a)||(f.values.push(a),f.sum+=a,a<f.min&&(f.min=a),a>f.max&&(f.max=a),f.count+=1)},h=function(a,e){return c(a,e)?d(null!=b&&"function"===I(b)?b(a):null!=b&&"string"===I(b)||"number"===I(b)?a[b]:a):void 0},"array"===I(a))for(i=0,k=a.length;k>i;i++)g=a[i],h(g);else for(e in a)g=a[e],h(g,e);return f.domain=[f.min,f.max],f.limits=function(a,b){return j.limits(f,a,b)},f},j.limits=function(a,b,c){var d,e,f,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb;if(null==b&&(b="equal"),null==c&&(c=7),"array"===I(a)&&(a=j.analyze(a)),q=a.min,o=a.max,A=a.sum,D=a.values.sort(function(a,b){return a-b}),n=[],"c"===b.substr(0,1)&&(n.push(q),n.push(o)),"e"===b.substr(0,1)){for(n.push(q),k=E=1,P=c-1;P>=1?P>=E:E>=P;k=P>=1?++E:--E)n.push(q+k/c*(o-q));n.push(o)}else if("l"===b.substr(0,1)){if(0>=q)throw"Logarithmic scales are only possible for values > 0";for(r=Math.LOG10E*Math.log(q),p=Math.LOG10E*Math.log(o),n.push(q),k=F=1,W=c-1;W>=1?W>=F:F>=W;k=W>=1?++F:--F)n.push(Math.pow(10,r+k/c*(p-r)));n.push(o)}else if("q"===b.substr(0,1)){for(n.push(q),k=G=1,X=c-1;X>=1?X>=G:G>=X;k=X>=1?++G:--G)w=D.length*k/c,x=Math.floor(w),x===w?n.push(D[x]):(y=w-x,n.push(D[x]*y+D[x+1]*(1-y)));n.push(o)}else if("k"===b.substr(0,1)){for(t=D.length,d=new Array(t),h=new Array(c),z=!0,u=0,f=null,f=[],f.push(q),k=H=1,Y=c-1;Y>=1?Y>=H:H>=Y;k=Y>=1?++H:--H)f.push(q+k/c*(o-q));for(f.push(o);z;){for(l=J=0,Z=c-1;Z>=0?Z>=J:J>=Z;l=Z>=0?++J:--J)h[l]=0;for(k=K=0,$=t-1;$>=0?$>=K:K>=$;k=$>=0?++K:--K){for(C=D[k],s=Number.MAX_VALUE,l=L=0,_=c-1;_>=0?_>=L:L>=_;l=_>=0?++L:--L)i=Math.abs(f[l]-C),s>i&&(s=i,e=l);h[e]++,d[k]=e}for(v=new Array(c),l=M=0,ab=c-1;ab>=0?ab>=M:M>=ab;l=ab>=0?++M:--M)v[l]=null;for(k=N=0,bb=t-1;bb>=0?bb>=N:N>=bb;k=bb>=0?++N:--N)g=d[k],null===v[g]?v[g]=D[k]:v[g]+=D[k];for(l=O=0,Q=c-1;Q>=0?Q>=O:O>=Q;l=Q>=0?++O:--O)v[l]*=1/h[l];for(z=!1,l=cb=0,R=c-1;R>=0?R>=cb:cb>=R;l=R>=0?++cb:--cb)if(v[l]!==f[k]){z=!0;break}f=v,u++,u>200&&(z=!1)}for(m={},l=db=0,S=c-1;S>=0?S>=db:db>=S;l=S>=0?++db:--db)m[l]=[];for(k=eb=0,T=t-1;T>=0?T>=eb:eb>=T;k=T>=0?++eb:--eb)g=d[k],m[g].push(D[k]);for(B=[],l=fb=0,U=c-1;U>=0?U>=fb:fb>=U;l=U>=0?++fb:--fb)B.push(m[l][0]),B.push(m[l][m[l].length-1]);for(B=B.sort(function(a,b){return a-b}),n.push(B[0]),k=gb=1,V=B.length-1;V>=gb;k=gb+=2)isNaN(B[k])||n.push(B[k])}return n},j.brewer=i={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},j.colors=l={indigo:"#4b0082",gold:"#ffd700",hotpink:"#ff69b4",firebrick:"#b22222",indianred:"#cd5c5c",yellow:"#ffff00",mistyrose:"#ffe4e1",darkolivegreen:"#556b2f",olive:"#808000",darkseagreen:"#8fbc8f",pink:"#ffc0cb",tomato:"#ff6347",lightcoral:"#f08080",orangered:"#ff4500",navajowhite:"#ffdead",lime:"#00ff00",palegreen:"#98fb98",darkslategrey:"#2f4f4f",greenyellow:"#adff2f",burlywood:"#deb887",seashell:"#fff5ee",mediumspringgreen:"#00fa9a",fuchsia:"#ff00ff",papayawhip:"#ffefd5",blanchedalmond:"#ffebcd",chartreuse:"#7fff00",dimgray:"#696969",black:"#000000",peachpuff:"#ffdab9",springgreen:"#00ff7f",aquamarine:"#7fffd4",white:"#ffffff",orange:"#ffa500",lightsalmon:"#ffa07a",darkslategray:"#2f4f4f",brown:"#a52a2a",ivory:"#fffff0",dodgerblue:"#1e90ff",peru:"#cd853f",lawngreen:"#7cfc00",chocolate:"#d2691e",crimson:"#dc143c",forestgreen:"#228b22",darkgrey:"#a9a9a9",lightseagreen:"#20b2aa",cyan:"#00ffff",mintcream:"#f5fffa",silver:"#c0c0c0",antiquewhite:"#faebd7",mediumorchid:"#ba55d3",skyblue:"#87ceeb",gray:"#808080",darkturquoise:"#00ced1",goldenrod:"#daa520",darkgreen:"#006400",floralwhite:"#fffaf0",darkviolet:"#9400d3",darkgray:"#a9a9a9",moccasin:"#ffe4b5",saddlebrown:"#8b4513",grey:"#808080",darkslateblue:"#483d8b",lightskyblue:"#87cefa",lightpink:"#ffb6c1",mediumvioletred:"#c71585",slategrey:"#708090",red:"#ff0000",deeppink:"#ff1493",limegreen:"#32cd32",darkmagenta:"#8b008b",palegoldenrod:"#eee8aa",plum:"#dda0dd",turquoise:"#40e0d0",lightgrey:"#d3d3d3",lightgoldenrodyellow:"#fafad2",darkgoldenrod:"#b8860b",lavender:"#e6e6fa",maroon:"#800000",yellowgreen:"#9acd32",sandybrown:"#f4a460",thistle:"#d8bfd8",violet:"#ee82ee",navy:"#000080",magenta:"#ff00ff",dimgrey:"#696969",tan:"#d2b48c",rosybrown:"#bc8f8f",olivedrab:"#6b8e23",blue:"#0000ff",lightblue:"#add8e6",ghostwhite:"#f8f8ff",honeydew:"#f0fff0",cornflowerblue:"#6495ed",slateblue:"#6a5acd",linen:"#faf0e6",darkblue:"#00008b",powderblue:"#b0e0e6",seagreen:"#2e8b57",darkkhaki:"#bdb76b",snow:"#fffafa",sienna:"#a0522d",mediumblue:"#0000cd",royalblue:"#4169e1",lightcyan:"#e0ffff",green:"#008000",mediumpurple:"#9370db",midnightblue:"#191970",cornsilk:"#fff8dc",paleturquoise:"#afeeee",bisque:"#ffe4c4",slategray:"#708090",darkcyan:"#008b8b",khaki:"#f0e68c",wheat:"#f5deb3",teal:"#008080",darkorchid:"#9932cc",deepskyblue:"#00bfff",salmon:"#fa8072",darkred:"#8b0000",steelblue:"#4682b4",palevioletred:"#db7093",lightslategray:"#778899",aliceblue:"#f0f8ff",lightslategrey:"#778899",lightgreen:"#90ee90",orchid:"#da70d6",gainsboro:"#dcdcdc",mediumseagreen:"#3cb371",lightgray:"#d3d3d3",mediumturquoise:"#48d1cc",lemonchiffon:"#fffacd",cadetblue:"#5f9ea0",lightyellow:"#ffffe0",lavenderblush:"#fff0f5",coral:"#ff7f50",purple:"#800080",aqua:"#00ffff",whitesmoke:"#f5f5f5",mediumslateblue:"#7b68ee",darkorange:"#ff8c00",mediumaquamarine:"#66cdaa",darksalmon:"#e9967a",beige:"#f5f5dc",blueviolet:"#8a2be2",azure:"#f0ffff",lightsteelblue:"#b0c4de",oldlace:"#fdf5e6"},I=function(){var a,b,c,d,e;for(a={},e="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),c=0,d=e.length;d>c;c++)b=e[c],a["[object "+b+"]"]=b.toLowerCase();return function(b){var c;return c=Object.prototype.toString.call(b),a[c]||"object"}}(),x=function(a,b,c){return null==b&&(b=0),null==c&&(c=1),b>a&&(a=b),a>c&&(a=c),a},J=function(a){return a.length>=3?a:a[0]},d=2*Math.PI,c=Math.PI/3,m=Math.cos,h=function(a){var b,c,d,e,f,g,i,k,l,m,n;return a=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)e=a[b],d.push(j(e));return d}(),2===a.length?(l=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)e=a[b],d.push(e.lab());return d}(),f=l[0],g=l[1],b=function(a){var b,c;return c=function(){var c,d;for(d=[],b=c=0;2>=c;b=++c)d.push(f[b]+a*(g[b]-f[b]));return d}(),j.lab.apply(j,c)}):3===a.length?(m=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)e=a[b],d.push(e.lab());return d}(),f=m[0],g=m[1],i=m[2],b=function(a){var b,c;return c=function(){var c,d;for(d=[],b=c=0;2>=c;b=++c)d.push((1-a)*(1-a)*f[b]+2*(1-a)*a*g[b]+a*a*i[b]);return d}(),j.lab.apply(j,c)}):4===a.length?(n=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)e=a[b],d.push(e.lab());return d}(),f=n[0],g=n[1],i=n[2],k=n[3],b=function(a){var b,c;return c=function(){var c,d;for(d=[],b=c=0;2>=c;b=++c)d.push((1-a)*(1-a)*(1-a)*f[b]+3*(1-a)*(1-a)*a*g[b]+3*(1-a)*a*a*i[b]+a*a*a*k[b]);return d}(),j.lab.apply(j,c)}):5===a.length&&(c=h(a.slice(0,3)),d=h(a.slice(2,5)),b=function(a){return.5>a?c(2*a):d(2*(a-.5))}),b},j.interpolate.bezier=h}).call(this),function(a){var b={},c=b.hasOwnProperty,d=function(a,b){var d;for(d in a)c.call(a,d)&&b(d,a[d])},e=function(a,b){return b?(d(b,function(b,c){a[b]=c}),a):a},f=/["'\\\b\f\n\r\t]/,g=/[ !#-&\(-\[\]-~]/,h=function(a,b){var c={es6:!1,json:!1},d=b&&b.json;b=e(c,b);var h,i,j,k,l=a,m=-1,n=l.length;for(h="";++m<n;){var o=l.charAt(m);if(b.es6&&(i=l.charCodeAt(m),i>=55296&&56319>=i&&n>m+1&&(j=l.charCodeAt(m+1),j>=56320&&57343>=j)))k=1024*(i-55296)+j-56320+65536,h+="\\u{"+k.toString(16).toUpperCase()+"}",m++;else if(g.test(o))h+=o;else if('"'!=o)if("'"!=o)if(f.test(o))h+=o;else{var p=o.charCodeAt(0),q=p.toString(16).toUpperCase(),r=q.length>2||d,s="\\"+(r?"u":"x")+("0000"+q).slice(r?-4:-2);h+=s}else h+=o;else h+=o}return h};h.version="0.5.0",a.jsesc=h}(this),function(a){var b=function(){"use strict";var a="s",c=function(a){var b=-a.getTimezoneOffset();return null!==b?b:0},d=function(a,b,c){var d=new Date;return void 0!==a&&d.setFullYear(a),d.setMonth(b),d.setDate(c),d},e=function(a){return c(d(a,0,2))},f=function(a){return c(d(a,5,2))},g=function(a){var b=a.getMonth()>7,d=b?f(a.getFullYear()):e(a.getFullYear()),g=c(a),h=0>d,i=d-g;return h||b?0!==i:0>i},h=function(){var b=e(),c=f(),d=b-c;return 0>d?b+",1":d>0?c+",1,"+a:b+",0"},i=function(){var a=h();return new b.TimeZone(b.olson.timezones[a])},j=function(a){var b=new Date(2010,6,15,1,0,0,0),c={"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"America/Asuncion":new Date(2012,9,7,3,0,0,0),"America/Santiago":new Date(2012,9,3,3,0,0,0),"America/Campo_Grande":new Date(2012,9,21,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2012,2,10,2,0,0,0),"America/New_York":new Date(2012,2,10,7,0,0,0),"Europe/Helsinki":new Date(2013,2,31,5,0,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0),"Europe/Moscow":b,"Asia/Amman":new Date(2013,2,29,1,0,0,0),"Asia/Beirut":new Date(2013,2,31,2,0,0,0),"Asia/Damascus":new Date(2013,3,6,2,0,0,0),"Asia/Jerusalem":new Date(2013,2,29,5,0,0,0),"Asia/Yekaterinburg":b,"Asia/Omsk":b,"Asia/Krasnoyarsk":b,"Asia/Irkutsk":b,"Asia/Yakutsk":b,"Asia/Vladivostok":b,"Asia/Baku":new Date(2013,2,31,4,0,0),"Asia/Yerevan":new Date(2013,2,31,3,0,0),"Asia/Kamchatka":b,"Asia/Gaza":new Date(2010,2,27,4,0,0),"Africa/Cairo":new Date(2010,4,1,3,0,0),"Europe/Minsk":b,"Pacific/Apia":new Date(2010,10,1,1,0,0,0),"Pacific/Fiji":new Date(2010,11,1,0,0,0),"Australia/Perth":new Date(2008,10,1,1,0,0,0)};return c[a]};return{determine:i,date_is_dst:g,dst_start_for:j}}();b.TimeZone=function(a){"use strict";var c={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Santiago":["America/Santiago","America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Asia/Beirut","Europe/Helsinki","Asia/Damascus"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"],"Asia/Dubai":["Europe/Moscow"],"Asia/Dhaka":["Asia/Yekaterinburg"],"Asia/Jakarta":["Asia/Omsk"],"Asia/Shanghai":["Asia/Krasnoyarsk","Australia/Perth"],"Asia/Tokyo":["Asia/Irkutsk"],"Australia/Brisbane":["Asia/Yakutsk"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Tarawa":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk"],"Asia/Baku":["Asia/Yerevan","Asia/Baku"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},d=a,e=function(){for(var a=c[d],e=a.length,f=0,g=a[0];e>f;f+=1)if(g=a[f],b.date_is_dst(b.dst_start_for(g)))return void(d=g)},f=function(){return"undefined"!=typeof c[d]};return f()&&e(),{name:function(){return d}}},b.olson={},b.olson.timezones={"-720,0":"Pacific/Majuro","-660,0":"Pacific/Pago_Pago","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Tarawa","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},"undefined"!=typeof exports?exports.jstz=b:a.jstz=b}(this),LazyLoad=function(a){function b(b,c){var d,e=a.createElement(b);for(d in c)c.hasOwnProperty(d)&&e.setAttribute(d,c[d]);return e}function c(a){var b,c,d=j[a];d&&(b=d.callback,c=d.urls,c.shift(),k=0,c.length||(b&&b.call(d.context,d.obj),j[a]=null,l[a].length&&e(a)))}function d(){var b=navigator.userAgent;h={async:a.createElement("script").async===!0},(h.webkit=/AppleWebKit\//.test(b))||(h.ie=/MSIE|Trident/.test(b))||(h.opera=/Opera/.test(b))||(h.gecko=/Gecko\//.test(b))||(h.unknown=!0)}function e(e,k,m,n,o){var p,q,r,s,t,u,v=function(){c(e)},w="css"===e,x=[];if(h||d(),k)if(k="string"==typeof k?[k]:k.concat(),w||h.async||h.gecko||h.opera)l[e].push({urls:k,callback:m,obj:n,context:o});else for(p=0,q=k.length;q>p;++p)l[e].push({urls:[k[p]],callback:p===q-1?m:null,obj:n,context:o});if(!j[e]&&(s=j[e]=l[e].shift())){for(i||(i=a.head||a.getElementsByTagName("head")[0]),t=s.urls.concat(),p=0,q=t.length;q>p;++p)u=t[p],w?r=h.gecko?b("style"):b("link",{href:u,rel:"stylesheet"}):(r=b("script",{src:u}),r.async=!1),r.className="lazyload",r.setAttribute("charset","utf-8"),h.ie&&!w&&"onreadystatechange"in r&&!("draggable"in r)?r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=null,v())}:w&&(h.gecko||h.webkit)?h.webkit?(s.urls[p]=r.href,g()):(r.innerHTML='@import "'+u+'";',f(r)):r.onload=r.onerror=v,x.push(r);for(p=0,q=x.length;q>p;++p)i.appendChild(x[p])}}function f(a){var b;try{b=!!a.sheet.cssRules}catch(d){return k+=1,void(200>k?setTimeout(function(){f(a)},50):b&&c("css"))}c("css")}function g(){var a,b=j.css;if(b){for(a=m.length;--a>=0;)if(m[a].href===b.urls[0]){c("css");break}k+=1,b&&(200>k?setTimeout(g,50):c("css"))}}var h,i,j={},k=0,l={css:[],js:[]},m=a.styleSheets;return{css:function(a,b,c,d){e("css",a,b,c,d)},js:function(a,b,c,d){e("js",a,b,c,d)}}}(this.document),window.Modernizr=function(a,b,c){function d(a){o.cssText=a
}function e(a,b){return typeof a===b}var f,g,h,i="2.8.3",j={},k=!0,l=b.documentElement,m="modernizr",n=b.createElement(m),o=n.style,p=({}.toString,{svg:"http://www.w3.org/2000/svg"}),q={},r=[],s=r.slice,t={}.hasOwnProperty;h=e(t,"undefined")||e(t.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return t.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=s.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(s.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(s.call(arguments)))};return d}),q.geolocation=function(){return"geolocation"in navigator},q.svg=function(){return!!b.createElementNS&&!!b.createElementNS(p.svg,"svg").createSVGRect},q.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==p.svg};for(var u in q)h(q,u)&&(g=u.toLowerCase(),j[g]=q[u](),r.push((j[g]?"":"no-")+g));return j.addTest=function(a,b){if("object"==typeof a)for(var d in a)h(a,d)&&j.addTest(d,a[d]);else{if(a=a.toLowerCase(),j[a]!==c)return j;b="function"==typeof b?b():b,"undefined"!=typeof k&&k&&(l.className+=" "+(b?"":"no-")+a),j[a]=b}return j},d(""),n=f=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=s.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=r[a[p]];return b||(b={},q++,a[p]=q,r[q]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():o.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),!f.canHaveChildren||n.test(a)||f.tagUrn?f:d.frag.appendChild(f)}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function i(a){a||(a=b);var d=e(a);return!s.shivCSS||j||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||h(a,d),a}var j,k,l="3.7.0",m=a.html5||{},n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,o=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",q=0,r={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var s={elements:m.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:l,shivCSS:m.shivCSS!==!1,supportsUnknownElements:k,shivMethods:m.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=s,i(b)}(this,b),j._version=i,l.className=l.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(k?" js "+r.join(" "):""),j}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==q.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=r.shift();s=1,a?a.t?o(function(){("c"==a.t?m.injectCss:m.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):s=0}function i(a,c,d,e,f,i,j){function k(b){if(!n&&g(l.readyState)&&(t.r=n=1,!s&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&o(function(){v.removeChild(l)},50);for(var d in A[c])A[c].hasOwnProperty(d)&&A[c][d].onload()}}var j=j||m.errorTimeout,l=b.createElement(a),n=0,q=0,t={t:d,s:c,e:f,a:i,x:j};1===A[c]&&(q=1,A[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,q)},r.splice(e,0,t),"img"!=a&&(q||2===A[c]?(v.insertBefore(l,u?null:p),o(k,j)):A[c].push(l))}function j(a,b,c,d,f){return s=0,b=b||"j",e(a)?i("c"==b?x:w,a,b,this.i++,c,d,f):(r.splice(this.i++,0,a),1==r.length&&h()),this}function k(){var a=m;return a.loader={load:j,i:0},a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,n=a.opera&&"[object Opera]"==q.call(a.opera),n=!!b.attachEvent&&!n,w=t?"object":n?"script":"img",x=n?"script":w,y=Array.isArray||function(a){return"[object Array]"==q.call(a)},z=[],A={},B={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};m=function(a){function b(a){var b,c,d,a=a.split("!"),e=z.length,f=a.pop(),g=a.length,f={url:f,origUrl:f,prefixes:a};for(c=0;g>c;c++)d=a[c].split("="),(b=B[d.shift()])&&(f=b(f,d));for(c=0;e>c;c++)f=z[c](f);return f}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(A[i.url]?i.noexec=!0:A[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),A[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}),g(a,l,b,0,j);else if(Object(a)===a)for(i in h=function(){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}(),a)a.hasOwnProperty(i)&&(!c&&!--h&&(d(l)?l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}:l[i]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),n()}}(m[i])),g(a[i],l,b,i,j))}else!c&&n()}var h,i,j=!!a.test,k=a.load||a.both,l=a.callback||f,m=l,n=a.complete||f;c(j?a.yep:a.nope,!!k),k&&c(k)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(y(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):y(j)?m(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},m.addPrefix=function(a,b){B[a]=b},m.addFilter=function(a){z.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k,l,n=b.createElement("script"),e=e||m.errorTimeout;n.src=a;for(l in d)n.setAttribute(l,d[l]);c=j?h:c||f,n.onreadystatechange=n.onload=function(){!k&&g(n.readyState)&&(k=1,c(),n.onload=n.onreadystatechange=null)},o(function(){k||(k=1,c(1))},e),i?n.onload():p.parentNode.insertBefore(n,p)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(p.parentNode.insertBefore(e,p),o(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cors",!!(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest)),function(a){function b(a,b,c){switch(arguments.length){case 2:return null!=a?a:b;case 3:return null!=a?a:null!=b?b:c;default:throw new Error("Implement me")}}function c(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function d(a,b){function c(){pb.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+a)}var d=!0;return j(function(){return d&&(c(),d=!1),b.apply(this,arguments)},b)}function e(a,b){return function(c){return m(a.call(this,c),b)}}function f(a,b){return function(c){return this.lang().ordinal(a.call(this,c),b)}}function g(){}function h(a){B(a),j(this,a)}function i(a){var b=u(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._bubble()}function j(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function k(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&Db.hasOwnProperty(b)&&(c[b]=a[b]);return c}function l(a){return 0>a?Math.ceil(a):Math.floor(a)}function m(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function n(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function o(a,b){var c;return b=E(b,a),a.isBefore(b)?c=n(a,b):(c=n(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function p(a,b,c,d){var e=b._milliseconds,f=b._days,g=b._months;d=null==d?!0:d,e&&a._d.setTime(+a._d+e*c),f&&jb(a,"Date",ib(a,"Date")+f*c),g&&hb(a,ib(a,"Month")+g*c),d&&pb.updateOffset(a,f||g)}function q(a){return"[object Array]"===Object.prototype.toString.call(a)}function r(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function s(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&w(a[d])!==w(b[d]))&&g++;return g+f}function t(a){if(a){var b=a.toLowerCase().replace(/(.)s$/,"$1");a=ec[a]||fc[b]||b}return a}function u(a){var b,c,d={};for(c in a)a.hasOwnProperty(c)&&(b=t(c),b&&(d[b]=a[c]));return d}function v(b){var c,d;if(0===b.indexOf("week"))c=7,d="day";else{if(0!==b.indexOf("month"))return;c=12,d="month"}pb[b]=function(e,f){var g,h,i=pb.fn._lang[b],j=[];if("number"==typeof e&&(f=e,e=a),h=function(a){var b=pb().utc().set(d,a);return i.call(pb.fn._lang,b,e||"")},null!=f)return h(f);for(g=0;c>g;g++)j.push(h(g));return j}}function w(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function x(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function y(a,b,c){return db(pb([a,11,31+b-c]),b,c).week}function z(a){return A(a)?366:365}function A(a){return a%4===0&&a%100!==0||a%400===0}function B(a){var b;a._a&&-2===a._pf.overflow&&(b=a._a[wb]<0||a._a[wb]>11?wb:a._a[xb]<1||a._a[xb]>x(a._a[vb],a._a[wb])?xb:a._a[yb]<0||a._a[yb]>23?yb:a._a[zb]<0||a._a[zb]>59?zb:a._a[Ab]<0||a._a[Ab]>59?Ab:a._a[Bb]<0||a._a[Bb]>999?Bb:-1,a._pf._overflowDayOfYear&&(vb>b||b>xb)&&(b=xb),a._pf.overflow=b)}function C(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length)),a._isValid}function D(a){return a?a.toLowerCase().replace("_","-"):a}function E(a,b){return b._isUTC?pb(a).zone(b._offset||0):pb(a).local()}function F(a,b){return b.abbr=a,Cb[a]||(Cb[a]=new g),Cb[a].set(b),Cb[a]}function G(a){delete Cb[a]}function H(a){var b,c,d,e,f=0,g=function(a){if(!Cb[a]&&Eb)try{require("./lang/"+a)}catch(b){}return Cb[a]};if(!a)return pb.fn._lang;if(!q(a)){if(c=g(a))return c;a=[a]}for(;f<a.length;){for(e=D(a[f]).split("-"),b=e.length,d=D(a[f+1]),d=d?d.split("-"):null;b>0;){if(c=g(e.slice(0,b).join("-")))return c;if(d&&d.length>=b&&s(e,d,!0)>=b-1)break;b--}f++}return pb.fn._lang}function I(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function J(a){var b,c,d=a.match(Ib);for(b=0,c=d.length;c>b;b++)d[b]=kc[d[b]]?kc[d[b]]:I(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function K(a,b){return a.isValid()?(b=L(b,a.lang()),gc[b]||(gc[b]=J(b)),gc[b](a)):a.lang().invalidDate()}function L(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Jb.lastIndex=0;d>=0&&Jb.test(a);)a=a.replace(Jb,c),Jb.lastIndex=0,d-=1;return a}function M(a,b){var c,d=b._strict;switch(a){case"Q":return Ub;case"DDDD":return Wb;case"YYYY":case"GGGG":case"gggg":return d?Xb:Mb;case"Y":case"G":case"g":return Zb;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return d?Yb:Nb;case"S":if(d)return Ub;case"SS":if(d)return Vb;case"SSS":if(d)return Wb;case"DDD":return Lb;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Pb;case"a":case"A":return H(b._l)._meridiemParse;case"X":return Sb;case"Z":case"ZZ":return Qb;case"T":return Rb;case"SSSS":return Ob;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return d?Vb:Kb;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Kb;case"Do":return Tb;default:return c=new RegExp(V(U(a.replace("\\","")),"i"))}}function N(a){a=a||"";var b=a.match(Qb)||[],c=b[b.length-1]||[],d=(c+"").match(cc)||["-",0,0],e=+(60*d[1])+w(d[2]);return"+"===d[0]?-e:e}function O(a,b,c){var d,e=c._a;switch(a){case"Q":null!=b&&(e[wb]=3*(w(b)-1));break;case"M":case"MM":null!=b&&(e[wb]=w(b)-1);break;case"MMM":case"MMMM":d=H(c._l).monthsParse(b),null!=d?e[wb]=d:c._pf.invalidMonth=b;break;case"D":case"DD":null!=b&&(e[xb]=w(b));break;case"Do":null!=b&&(e[xb]=w(parseInt(b,10)));break;case"DDD":case"DDDD":null!=b&&(c._dayOfYear=w(b));break;case"YY":e[vb]=pb.parseTwoDigitYear(b);break;case"YYYY":case"YYYYY":case"YYYYYY":e[vb]=w(b);break;case"a":case"A":c._isPm=H(c._l).isPM(b);break;case"H":case"HH":case"h":case"hh":e[yb]=w(b);break;case"m":case"mm":e[zb]=w(b);break;case"s":case"ss":e[Ab]=w(b);break;case"S":case"SS":case"SSS":case"SSSS":e[Bb]=w(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=N(b);break;case"dd":case"ddd":case"dddd":d=H(c._l).weekdaysParse(b),null!=d?(c._w=c._w||{},c._w.d=d):c._pf.invalidWeekday=b;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":a=a.substr(0,1);case"gggg":case"GGGG":case"GGGGG":a=a.substr(0,2),b&&(c._w=c._w||{},c._w[a]=w(b));break;case"gg":case"GG":c._w=c._w||{},c._w[a]=pb.parseTwoDigitYear(b)}}function P(a){var c,d,e,f,g,h,i,j;c=a._w,null!=c.GG||null!=c.W||null!=c.E?(g=1,h=4,d=b(c.GG,a._a[vb],db(pb(),1,4).year),e=b(c.W,1),f=b(c.E,1)):(j=H(a._l),g=j._week.dow,h=j._week.doy,d=b(c.gg,a._a[vb],db(pb(),g,h).year),e=b(c.w,1),null!=c.d?(f=c.d,g>f&&++e):f=null!=c.e?c.e+g:g),i=eb(d,e,f,h,g),a._a[vb]=i.year,a._dayOfYear=i.dayOfYear}function Q(a){var c,d,e,f,g=[];if(!a._d){for(e=S(a),a._w&&null==a._a[xb]&&null==a._a[wb]&&P(a),a._dayOfYear&&(f=b(a._a[vb],e[vb]),a._dayOfYear>z(f)&&(a._pf._overflowDayOfYear=!0),d=_(f,0,a._dayOfYear),a._a[wb]=d.getUTCMonth(),a._a[xb]=d.getUTCDate()),c=0;3>c&&null==a._a[c];++c)a._a[c]=g[c]=e[c];for(;7>c;c++)a._a[c]=g[c]=null==a._a[c]?2===c?1:0:a._a[c];a._d=(a._useUTC?_:$).apply(null,g),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()+a._tzm)}}function R(a){var b;a._d||(b=u(a._i),a._a=[b.year,b.month,b.day,b.hour,b.minute,b.second,b.millisecond],Q(a))}function S(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function T(a){if(a._f===pb.ISO_8601)return void X(a);a._a=[],a._pf.empty=!0;var b,c,d,e,f,g=H(a._l),h=""+a._i,i=h.length,j=0;for(d=L(a._f,g).match(Ib)||[],b=0;b<d.length;b++)e=d[b],c=(h.match(M(e,a))||[])[0],c&&(f=h.substr(0,h.indexOf(c)),f.length>0&&a._pf.unusedInput.push(f),h=h.slice(h.indexOf(c)+c.length),j+=c.length),kc[e]?(c?a._pf.empty=!1:a._pf.unusedTokens.push(e),O(e,c,a)):a._strict&&!c&&a._pf.unusedTokens.push(e);a._pf.charsLeftOver=i-j,h.length>0&&a._pf.unusedInput.push(h),a._isPm&&a._a[yb]<12&&(a._a[yb]+=12),a._isPm===!1&&12===a._a[yb]&&(a._a[yb]=0),Q(a),B(a)}function U(a){return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e})}function V(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function W(a){var b,d,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,void(a._d=new Date(0/0));for(f=0;f<a._f.length;f++)g=0,b=j({},a),b._pf=c(),b._f=a._f[f],T(b),C(b)&&(g+=b._pf.charsLeftOver,g+=10*b._pf.unusedTokens.length,b._pf.score=g,(null==e||e>g)&&(e=g,d=b));j(a,d||b)}function X(a){var b,c,d=a._i,e=$b.exec(d);if(e){for(a._pf.iso=!0,b=0,c=ac.length;c>b;b++)if(ac[b][1].exec(d)){a._f=ac[b][0]+(e[6]||" ");break}for(b=0,c=bc.length;c>b;b++)if(bc[b][1].exec(d)){a._f+=bc[b][0];break}d.match(Qb)&&(a._f+="Z"),T(a)}else a._isValid=!1}function Y(a){X(a),a._isValid===!1&&(delete a._isValid,pb.createFromInputFallback(a))}function Z(b){var c,d=b._i;d===a?b._d=new Date:r(d)?b._d=new Date(+d):null!==(c=Fb.exec(d))?b._d=new Date(+c[1]):"string"==typeof d?Y(b):q(d)?(b._a=d.slice(0),Q(b)):"object"==typeof d?R(b):"number"==typeof d?b._d=new Date(d):pb.createFromInputFallback(b)}function $(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function _(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function ab(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function bb(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function cb(a,b,c){var d=pb.duration(a).abs(),e=ub(d.as("s")),f=ub(d.as("m")),g=ub(d.as("h")),h=ub(d.as("d")),i=ub(d.as("M")),j=ub(d.as("y")),k=e<hc.s&&["s",e]||1===f&&["m"]||f<hc.m&&["mm",f]||1===g&&["h"]||g<hc.h&&["hh",g]||1===h&&["d"]||h<hc.d&&["dd",h]||1===i&&["M"]||i<hc.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,bb.apply({},k)}function db(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=pb(a).add("d",f),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function eb(a,b,c,d,e){var f,g,h=_(a,0,1).getUTCDay();return h=0===h?7:h,c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:z(a-1)+g}}function fb(b){var c=b._i,d=b._f;return null===c||d===a&&""===c?pb.invalid({nullInput:!0}):("string"==typeof c&&(b._i=c=H().preparse(c)),pb.isMoment(c)?(b=k(c),b._d=new Date(+c._d)):d?q(d)?W(b):T(b):Z(b),new h(b))}function gb(a,b){var c,d;if(1===b.length&&q(b[0])&&(b=b[0]),!b.length)return pb();for(c=b[0],d=1;d<b.length;++d)b[d][a](c)&&(c=b[d]);return c}function hb(a,b){var c;return"string"==typeof b&&(b=a.lang().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),x(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function ib(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function jb(a,b,c){return"Month"===b?hb(a,c):a._d["set"+(a._isUTC?"UTC":"")+b](c)}function kb(a,b){return function(c){return null!=c?(jb(this,a,c),pb.updateOffset(this,b),this):ib(this,a)}}function lb(a){return 400*a/146097}function mb(a){return 146097*a/400}function nb(a){pb.duration.fn[a]=function(){return this._data[a]}}function ob(a){"undefined"==typeof ender&&(qb=tb.moment,tb.moment=a?d("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",pb):pb)}for(var pb,qb,rb,sb="2.7.0",tb="undefined"!=typeof global?global:this,ub=Math.round,vb=0,wb=1,xb=2,yb=3,zb=4,Ab=5,Bb=6,Cb={},Db={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_tzm:null,_isUTC:null,_offset:null,_pf:null,_lang:null},Eb="undefined"!=typeof module&&module.exports,Fb=/^\/?Date\((\-?\d+)/i,Gb=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Hb=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Ib=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Jb=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Kb=/\d\d?/,Lb=/\d{1,3}/,Mb=/\d{1,4}/,Nb=/[+\-]?\d{1,6}/,Ob=/\d+/,Pb=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Qb=/Z|[\+\-]\d\d:?\d\d/gi,Rb=/T/i,Sb=/[\+\-]?\d+(\.\d{1,3})?/,Tb=/\d{1,2}/,Ub=/\d/,Vb=/\d\d/,Wb=/\d{3}/,Xb=/\d{4}/,Yb=/[+-]?\d{6}/,Zb=/[+-]?\d+/,$b=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,_b="YYYY-MM-DDTHH:mm:ssZ",ac=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],bc=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],cc=/([\+\-]|\d\d)/gi,dc=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),ec={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},fc={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},gc={},hc={s:45,m:45,h:22,d:26,M:11},ic="DDD w W M D d".split(" "),jc="M D H h m s w W".split(" "),kc={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var a=this.year(),b=a>=0?"+":"-";return b+m(Math.abs(a),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return w(this.milliseconds()/100)},SS:function(){return m(w(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+m(w(a/60),2)+":"+m(w(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+m(w(a/60),2)+m(w(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},lc=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ic.length;)rb=ic.pop(),kc[rb+"o"]=f(kc[rb],rb);for(;jc.length;)rb=jc.pop(),kc[rb+rb]=e(kc[rb],2);kc.DDDD=e(kc.DDD,3),j(g.prototype,{set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;12>b;b++)if(this._monthsParse[b]||(c=pb.utc([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=pb([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return db(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),pb=function(b,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._i=b,g._f=d,g._l=e,g._strict=f,g._isUTC=!1,g._pf=c(),fb(g)},pb.suppressDeprecationWarnings=!1,pb.createFromInputFallback=d("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i)}),pb.min=function(){var a=[].slice.call(arguments,0);return gb("isBefore",a)},pb.max=function(){var a=[].slice.call(arguments,0);return gb("isAfter",a)},pb.utc=function(b,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._useUTC=!0,g._isUTC=!0,g._l=e,g._i=b,g._f=d,g._strict=f,g._pf=c(),fb(g).utc()},pb.unix=function(a){return pb(1e3*a)},pb.duration=function(a,b){var c,d,e,f,g=a,h=null;return pb.isDuration(a)?g={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(g={},b?g[b]=a:g.milliseconds=a):(h=Gb.exec(a))?(c="-"===h[1]?-1:1,g={y:0,d:w(h[xb])*c,h:w(h[yb])*c,m:w(h[zb])*c,s:w(h[Ab])*c,ms:w(h[Bb])*c}):(h=Hb.exec(a))?(c="-"===h[1]?-1:1,e=function(a){var b=a&&parseFloat(a.replace(",","."));return(isNaN(b)?0:b)*c},g={y:e(h[2]),M:e(h[3]),d:e(h[4]),h:e(h[5]),m:e(h[6]),s:e(h[7]),w:e(h[8])}):"object"==typeof g&&("from"in g||"to"in g)&&(f=o(pb(g.from),pb(g.to)),g={},g.ms=f.milliseconds,g.M=f.months),d=new i(g),pb.isDuration(a)&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},pb.version=sb,pb.defaultFormat=_b,pb.ISO_8601=function(){},pb.momentProperties=Db,pb.updateOffset=function(){},pb.relativeTimeThreshold=function(b,c){return hc[b]===a?!1:c===a?hc[b]:(hc[b]=c,!0)},pb.lang=function(a,b){var c;return a?(b?F(D(a),b):null===b?(G(a),a="en"):Cb[a]||H(a),c=pb.duration.fn._lang=pb.fn._lang=H(a),c._abbr):pb.fn._lang._abbr},pb.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),H(a)},pb.isMoment=function(a){return a instanceof h||null!=a&&a.hasOwnProperty("_isAMomentObject")},pb.isDuration=function(a){return a instanceof i};for(rb=lc.length-1;rb>=0;--rb)v(lc[rb]);pb.normalizeUnits=function(a){return t(a)},pb.invalid=function(a){var b=pb.utc(0/0);return null!=a?j(b._pf,a):b._pf.userInvalidated=!0,b},pb.parseZone=function(){return pb.apply(null,arguments).parseZone()},pb.parseTwoDigitYear=function(a){return w(a)+(w(a)>68?1900:2e3)},j(pb.fn=h.prototype,{clone:function(){return pb(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var a=pb(this).utc();return 0<a.year()&&a.year()<=9999?K(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):K(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return C(this)},isDSTShifted:function(){return this._a?this.isValid()&&s(this._a,(this._isUTC?pb.utc(this._a):pb(this._a)).toArray())>0:!1},parsingFlags:function(){return j({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(a){return this.zone(0,a)},local:function(a){return this._isUTC&&(this.zone(0,a),this._isUTC=!1,a&&this.add(this._d.getTimezoneOffset(),"m")),this},format:function(a){var b=K(this,a||pb.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a&&"string"==typeof b?pb.duration(isNaN(+b)?+a:+b,isNaN(+b)?b:a):"string"==typeof a?pb.duration(+b,a):pb.duration(a,b),p(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a&&"string"==typeof b?pb.duration(isNaN(+b)?+a:+b,isNaN(+b)?b:a):"string"==typeof a?pb.duration(+b,a):pb.duration(a,b),p(this,c,-1),this},diff:function(a,b,c){var d,e,f=E(a,this),g=6e4*(this.zone()-f.zone());return b=t(b),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-pb(this).startOf("month")-(f-pb(f).startOf("month")))/d,e-=6e4*(this.zone()-pb(this).startOf("month").zone()-(f.zone()-pb(f).startOf("month").zone()))/d,"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:l(e)},from:function(a,b){return pb.duration({to:this,from:a}).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(pb(),a)},calendar:function(a){var b=a||pb(),c=E(b,this).startOf("day"),d=this.diff(c,"days",!0),e=-6>d?"sameElse":-1>d?"lastWeek":0>d?"lastDay":1>d?"sameDay":2>d?"nextDay":7>d?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){return A(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=ab(a,this.lang()),this.add(a-b,"days")):b},month:kb("Month",!0),startOf:function(a){switch(a=t(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a?this.weekday(0):"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(a){return a=t(a),this.startOf(a).add("isoWeek"===a?"week":a,1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+pb(a).startOf(b)
},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+pb(a).startOf(b)},isSame:function(a,b){return b=b||"ms",+this.clone().startOf(b)===+E(a,this).startOf(b)},min:d("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(a){return a=pb.apply(null,arguments),this>a?this:a}),max:d("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(a){return a=pb.apply(null,arguments),a>this?this:a}),zone:function(a,b){var c,d=this._offset||0;return null==a?this._isUTC?d:this._d.getTimezoneOffset():("string"==typeof a&&(a=N(a)),Math.abs(a)<16&&(a=60*a),!this._isUTC&&b&&(c=this._d.getTimezoneOffset()),this._offset=a,this._isUTC=!0,null!=c&&this.subtract(c,"m"),d!==a&&(!b||this._changeInProgress?p(this,pb.duration(d-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,pb.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(a){return a=a?pb(a).zone():0,(this.zone()-a)%60===0},daysInMonth:function(){return x(this.year(),this.month())},dayOfYear:function(a){var b=ub((pb(this).startOf("day")-pb(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},quarter:function(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)},weekYear:function(a){var b=db(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==a?b:this.add("y",a-b)},isoWeekYear:function(a){var b=db(this,1,4).year;return null==a?b:this.add("y",a-b)},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},isoWeek:function(a){var b=db(this,1,4).week;return null==a?b:this.add("d",7*(a-b))},weekday:function(a){var b=(this.day()+7-this.lang()._week.dow)%7;return null==a?b:this.add("d",a-b)},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},isoWeeksInYear:function(){return y(this.year(),1,4)},weeksInYear:function(){var a=this._lang._week;return y(this.year(),a.dow,a.doy)},get:function(a){return a=t(a),this[a]()},set:function(a,b){return a=t(a),"function"==typeof this[a]&&this[a](b),this},lang:function(b){return b===a?this._lang:(this._lang=H(b),this)}}),pb.fn.millisecond=pb.fn.milliseconds=kb("Milliseconds",!1),pb.fn.second=pb.fn.seconds=kb("Seconds",!1),pb.fn.minute=pb.fn.minutes=kb("Minutes",!1),pb.fn.hour=pb.fn.hours=kb("Hours",!0),pb.fn.date=kb("Date",!0),pb.fn.dates=d("dates accessor is deprecated. Use date instead.",kb("Date",!0)),pb.fn.year=kb("FullYear",!0),pb.fn.years=d("years accessor is deprecated. Use year instead.",kb("FullYear",!0)),pb.fn.days=pb.fn.day,pb.fn.months=pb.fn.month,pb.fn.weeks=pb.fn.week,pb.fn.isoWeeks=pb.fn.isoWeek,pb.fn.quarters=pb.fn.quarter,pb.fn.toJSON=pb.fn.toISOString,j(pb.duration.fn=i.prototype,{_bubble:function(){var a,b,c,d=this._milliseconds,e=this._days,f=this._months,g=this._data,h=0;g.milliseconds=d%1e3,a=l(d/1e3),g.seconds=a%60,b=l(a/60),g.minutes=b%60,c=l(b/60),g.hours=c%24,e+=l(c/24),h=l(lb(e)),e-=l(mb(h)),f+=l(e/30),e%=30,h+=l(f/12),f%=12,g.days=e,g.months=f,g.years=h},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return l(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*w(this._months/12)},humanize:function(a){var b=cb(this,!a,this.lang());return a&&(b=this.lang().pastFuture(+this,b)),this.lang().postformat(b)},add:function(a,b){var c=pb.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=pb.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=t(a),this[a.toLowerCase()+"s"]()},as:function(a){var b,c;if(a=t(a),b=this._days+this._milliseconds/864e5,"month"===a||"year"===a)return c=this._months+12*lb(b),"month"===a?c:c/12;switch(b+=mb(this._months/12),a){case"week":return b/7;case"day":return b;case"hour":return 24*b;case"minute":return 24*b*60;case"second":return 24*b*60*60;case"millisecond":return 24*b*60*60*1e3;default:throw new Error("Unknown unit "+a)}},lang:pb.fn.lang,toIsoString:function(){var a=Math.abs(this.years()),b=Math.abs(this.months()),c=Math.abs(this.days()),d=Math.abs(this.hours()),e=Math.abs(this.minutes()),f=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}});for(rb in dc)dc.hasOwnProperty(rb)&&nb(rb.toLowerCase());pb.duration.fn.asMilliseconds=function(){return this.as("ms")},pb.duration.fn.asSeconds=function(){return this.as("s")},pb.duration.fn.asMinutes=function(){return this.as("m")},pb.duration.fn.asHours=function(){return this.as("h")},pb.duration.fn.asDays=function(){return this.as("d")},pb.duration.fn.asWeeks=function(){return this.as("weeks")},pb.duration.fn.asMonths=function(){return this.as("M")},pb.duration.fn.asYears=function(){return this.as("y")},pb.lang("en",{ordinal:function(a){var b=a%10,c=1===w(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),Eb?module.exports=pb:"function"==typeof define&&define.amd?(define("moment",function(a,b,c){return c.config&&c.config()&&c.config().noGlobal===!0&&(tb.moment=qb),pb}),ob(!0)):ob()}.call(this);var mod=angular.module("infinite-scroll",[]);mod.directive("infiniteScroll",["$rootScope","$window","$timeout",function(a,b,c){return{link:function(d,e,f){var g,h,i,j,k,l,m;return b=angular.element(b),g=e.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y"))}).eq(0),0===g.length&&(g=b),null!=f.infiniteScrollSelf&&(g=e),k=0,null!=f.infiniteScrollDistance&&d.$watch(f.infiniteScrollDistance,function(a){return k=parseFloat(a,10)}),l=!0,h=!1,null!=f.infiniteScrollDisabled&&d.$watch(f.infiniteScrollDisabled,function(a){return l=!a,l&&h?(h=!1,j()):void 0}),m=g!==b?g.position().top:0,i=e.position().top-m,j=function(){var b,c,j,m;return e==g?(c=e[0].scrollHeight-e.scrollTop()-e.height(),m=c<=e[0].scrollHeight*k):(b=i+e.height(),j=g.height()+g.scrollTop(),c=b-j,m=c<=g.height()*k),m&&l?a.$$phase?d.$eval(f.infiniteScroll):d.$apply(f.infiniteScroll):m?h=!0:void 0},g.on("scroll",j),j(),d.$on("$destroy",function(){return g.off("scroll",j)}),c(function(){return f.infiniteScrollImmediateCheck?d.$eval(f.infiniteScrollImmediateCheck)?j():void 0:j()},0)}}}]),function(a){"use strict";function b(a){return a.replace(c,function(a,b,c,d){return d?c.toUpperCase():c}).replace(d,"Moz$1")}var c=/([\:\-\_]+(.))/g,d=/^moz([A-Z])/;a.module("translate",[],["$provide",function(b){b.factory("translate",["$log",function(b){var c={},d=!1,e=function(a,e){return a?(a=$.trim(a),a=a.replace(/<!--IE fix-->/g,""),a=a.replace(/ class="ng-binding"/g,""),c[e||"default"][a]?c[e||"default"][a]:(d&&b.warn('Missing localisation for "'+a+'"'),a)):""};return e.add=function(b,d){a.isUndefined(c[d||"default"])&&(c[d||"default"]={}),a.extend(c[d||"default"],b)},e.remove=function(a,b){return c[b||"default"][a]?(delete c[b||"default"][a],!0):!1},e.set=function(a,b){c[b||"default"]=a},e.logMissedHits=function(a){d=a},e}])}]),a.module("translate.directives",["translate"],["$compileProvider",function(c){c.directive("translate",["$compile","translate",function(c,d){return{priority:10,restrict:"ECMA",compile:function(e,f){var g=!1;if(f.translate){var h=f.translate.split(" ");a.forEach(h,function(a){e.attr(a,d(f[b(a)]))}),g=h.indexOf("innerHTML")>=0}else g=!0;return function(a,b){if(g){var e=d(b.html());b.empty().append(e)}try{c(b.contents())(a)}catch(f){}}}}}])}]),a.module("translate.filters",["translate"]).filter("translate",["translate",function(a){return function(b){return a(b)}}])}(angular),function(){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null==this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=new Array(g),e=0;g>e;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}()),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}),String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();(void 0===b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b}),window.hasOwnProperty||(window.hasOwnProperty=function(a){return Object.prototype.hasOwnProperty.call(window,a)}),window.selectText=function(a){var b,c,d=document;d.body.createTextRange?(b=document.body.createTextRange(),b.moveToElementText(a),b.select()):window.getSelection&&(c=window.getSelection(),b=document.createRange(),b.selectNodeContents(a),c.removeAllRanges(),c.addRange(b))},window.utf8_to_b64=function(a){return window.btoa(jsesc(a,{json:!0}))},window.b64_to_utf8=function(a){return window.atob(a)}}(),function(){"use strict";var a="0.1.3",b=angular.module("ods-widgets",["infinite-scroll","ngSanitize","translate","translate.directives","translate.filters"]);b.provider("ODSWidgetsConfig",function(){this.defaultConfig={ODSWidgetsVersion:a,defaultDomain:"",language:null,disqusShortname:null,customAPIHeaders:null,basemaps:[{provider:"mapquest",label:"MapQuest"}],mapGeobox:!1,chartColors:null,mapPrependAttribution:null,basePath:null,websiteName:null,themes:{}},this.customConfig={},this.setConfig=function(a){angular.extend(this.customConfig,a)},this.$get=function(){return angular.extend({},this.defaultConfig,this.customConfig)}}),b.run(["translate","ODSWidgetsConfig",function(a,b){if(a.add({}),!b.basePath){var c,d,e,f,g=document.getElementsByTagName("script"),h=/[\/^]ods-widgets(\.min)?\.js\??/;for(c=0;c<g.length;c++)d=g[c].src,e=d.match(h),e&&(f=d.split(h)[0],b.basePath=f?".js"===f.substring(f.length-3)?"":f+"/":"/")}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.factory("AggregationHelper",["translate",function(a){var b=[{label:a("Count"),func:"COUNT"},{label:a("Average"),func:"AVG"},{label:a("Minimum"),func:"MIN"},{label:a("Maximum"),func:"MAX"},{label:a("Standard deviation"),func:"STDDEV"},{label:a("Sum"),func:"SUM"},{label:a("Percentile"),func:"QUANTILES"}];return{getAvailableFunctions:function(){return b},getAvailableFunction:function(a){return b[a]},getFunctionLabel:function(a){return a=a.toUpperCase(),$.grep(b,function(b){return a===b.func})[0].label}}}]),a.factory("ChartHelper",["translate","AggregationHelper","ODSWidgetsConfig",function(a,b,c){var d,e={},f={},g={year:a("Year"),month:a("Month"),day:a("Day"),hour:a("Hour"),minute:a("Minute"),"month month":a("Month of year"),"day day":a("Day of month"),"day weekday":a("Day of week"),"day month":a("Day of year"),"hour hour":a("Hour of day")},h={},i=[],j={"top left":{center:["15%","20%"],size:"25%"},"top right":{center:["85%","20%"],size:"25%"},"bottom left":{center:["15%","80%"],size:"25%"},"bottom right":{center:["85%","80%"],size:"25%"},center:{}},k=c.chartColors||["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],l=[{label:a("Line"),type:"line",group:a("line charts")},{label:a("Spline"),type:"spline",group:a("line charts")},{label:a("Range"),type:"arearange",group:a("Area charts"),filter:"hasNumericField"},{label:a("Range spline"),type:"areasplinerange",group:a("Area charts"),filter:"hasNumericField"},{label:a("Column range"),type:"columnrange",group:a("Area charts"),filter:"hasNumericField"},{label:a("Area"),type:"area",group:a("Area charts")},{label:a("Area spline"),type:"areaspline",group:a("Area charts")},{label:a("Column chart"),type:"column",group:a("Bar charts")},{label:a("Bar chart"),type:"bar",group:a("Bar charts")},{label:a("Pie chart"),type:"pie",group:a("Pie charts")},{label:a("Scatter plot"),type:"scatter",group:a("line charts")}],m=["year","month","day","hour","minute"],n=["month month","day day","day weekday","day month","hour hour"],o=0,p={},q={},r=function(a,b,c){var d=!1;a?d=!0:a="date"==b?"day":"hour";for(var e=[],f=0;f<=m.indexOf(a)&&(e.push({name:m[f],label:g[m[f]]}),"date"!==b||"day"!=m[f])&&("datetime"!==b||d||"hour"!=m[f])&&("datetime"!==b||!d||"minute"!=m[f]);f++);if(c)for(var h=0;h<n.length&&(e.push({name:n[h],label:g[n[h]]}),"date"!==b||"day month"!=m[h]);h++);return e};return{getDatasetUniqueId:function(a){var b;if(angular.forEach(q,function(c,d){return d.endsWith(a)&&(b=c),!1}),b)return b.getUniqueId();throw new Exception("dataset "+a+" not loaded yet.")},getDataset:function(a){var b;return angular.forEach(q,function(c,d){return a===d&&(b=c),!1}),b},isChartSortable:function(a){return["arearange","areasplinerange","columnrange"].indexOf(a)<0},getAllTimescales:function(){return r("minute","datetime",!0)},getAvailableX:function(a,b){return"undefined"==typeof b?e[a]:e[a][b]},getAvailableY:function(a,b){return"undefined"==typeof b?f[a]:f[a][b]},getTimescales:function(a,b){for(var c,e,f=0;f<p[a].length;f++)if(p[a][f].name===b){e=p[a][f];break}if(e){if(e.annotations)for(var g=0;g<e.annotations.length;g++)if("timeserie_precision"==e.annotations[g].name){c=e.annotations[g].args[0];break}return r(c,e.type,d)}},init:function(a,b,c){"undefined"==typeof c&&(c=!1),"undefined"==typeof b&&(b=!1),d=b;var e=[],f=[],g=a.getUniqueId();if(c||!(g in i)){p[g]=a.fields;for(var h=0;h<p[g].length;h++){var j=p[g][h];if(("int"==j.type||"double"==j.type)&&f.push(j),"datetime"==j.type||"date"==j.type)e.unshift(j);else if(!b&&j.annotations)for(var k=0;k<j.annotations.length;k++){var l=j.annotations[k];"facet"==l.name&&e.push(j)}}this.setAvailableX(g,e),this.setAvailableY(g,f),i[g]=!0,q[g]=a,this.load(g)}},isInitialized:function(a){return""===a?!!i.length:!!(a in i)},load:function(a){if(h[a])for(var b=0;b<h[a].length;b++)h[a][b]();if(h[a]=[],h[""])for(var b=0;b<h[""].length;b++)h[""][b]();h[""]=[]},onLoad:function(a,b){"function"==typeof a&&(b=a,a=""),this.isInitialized(a)?b():(a in h||(h[a]=[]),h[a].indexOf(b)<0&&h[a].push(b))},setAvailableX:function(a,b){e[a]=b},setAvailableY:function(a,b){f[a]=b},resolvePosition:function(a){return void 0==typeof a&&(a="center"),a in j||(a="center"),j[a]},getPieChartPositions:function(){return $.map(j,function(a,b){return b})},getDefaultColors:function(){return k},getDefaultColor:function(a,b){if("undefined"!=typeof a&&""!==a)return o++,a;if("undefined"!=typeof b&&""!==b)return b;var c=k[o++%k.length];return c},getAvailableChartTypes:function(a){for(var b=[],c=0;c<l.length;c++)"undefined"==typeof l[c].filter?b.push(l[c]):q[a][l[c].filter]()&&b.push(l[c]);return b},setDefaultValues:function(a,b){""===b.yAxis?0===this.getAvailableY(a).length?b.func="COUNT":b.yAxis=this.getAvailableY(a,0).name:"COUNT"===b.func,this.isChartSortable(b.type)?(b.charts&&delete b.charts,"QUANTILES"===b.func?b.subsets||(b.subsets=50):b.subsets&&delete b.subsets):(b.func="COUNT",b.charts||(b.charts=[{func:"MIN",expr:b.yAxis},{func:"MAX",expr:b.yAxis}]),b.charts[0].expr||(b.charts[0].expr=b.yAxis),b.charts[1].expr||(b.charts[1].expr=b.yAxis),"QUANTILES"!==b.charts[0].func||b.charts[0].subsets||(b.charts[0].subsets=5),"QUANTILES"!==b.charts[1].func||b.charts[1].subsets||(b.charts[1].subsets=95),"QUANTILES"!==b.charts[0].func&&b.charts[0].subsets&&delete b.charts[0].subsets,"QUANTILES"!==b.charts[1].func&&b.charts[1].subsets&&delete b.charts[1].subsets),"pie"!==b.type||b.position||(b.position="center"),this.setColor(b)},setColor:function(a){"pie"===a.type?(a._color=a.color,delete a.color,a.extras=this.resolvePosition(a.position),a.extras.colors=this.getDefaultColors()):a.color=this.getDefaultColor(a.color,a._color)},getXLabel:function(a,b,c){var d=this.getFieldType(a,b),e=this.getFieldLabel(a,b);return"date"!==d&&"datetime"!==d||!c?e:e+" ("+g[c]+")"},getYLabel:function(a,c){if(c.yLabelOverride)return c.yLabelOverride;if(this.isChartSortable(c.type)){var d=b.getFunctionLabel(c.func),e=c.yAxis||c.expr,f=$.grep(this.getAvailableY(a),function(a){return a.name==e});return f.length>0&&"COUNT"!==c.func?d+" "+f[0].label:d}return this.getYLabel(a,c.charts[0])+" / "+this.getYLabel(a,c.charts[1])},getField:function(a,b){if(!p[a])return null;for(var c=0;c<p[a].length;c++){var d=p[a][c];if(d.name==b)return d}return void 0},getFieldLabel:function(a,b){var c=this.getField(a,b);return c?c.label:c},getFieldType:function(a,b){var c=this.getField(a,b);return c?c.type:c},getAvailableFunctions:function(c,d){return""==d||"undefined"==typeof this.getFieldType(d)?[{label:a("Count"),func:"COUNT"}]:b.getAvailableFunctions()}}}]),a.service("ODSAPI",["$http","ODSWidgetsConfig","odsErrorService",function(a,b,c){var d=function(d,e,f,g){var h=d?d.domainUrl:"";h+=e,f=f||{},f.timezone=jstz.determine().name(),d&&d.apikey&&(f.apikey=d.apikey);var i={params:f};return g&&(i.timeout=g),i.headers=b.customAPIHeaders?b.customAPIHeaders:{},i.headers["ODS-Widgets-Version"]=b.ODSWidgetsVersion,!d.domainUrl||Modernizr.cors?a.get(h,i).error(function(a){a&&c.sendErrorNotification(a)}):(h+=h.indexOf("?")>-1?"&":"?",h+="callback=JSON_CALLBACK",a.jsonp(h,i))};return{getDomainURL:function(a){var c=null;return angular.isUndefined(a)||null===a||""===a?c=b.defaultDomain:(c="/"!==a.substr(0,1)&&-1===a.indexOf(".")?a+".opendatasoft.com":a,"/"!==c.substr(0,1)&&-1===c.indexOf("http://")&&-1===c.indexOf("https://")&&(c="https://"+c)),"/"===c.substr(-1)&&(c=c.substr(0,c.length-1)),c},datasets:{get:function(a,b,c){return d(a,"/api/datasets/1.0/"+b+"/",c)},search:function(a,b){var c=angular.extend({},a.parameters,b);return d(a,"/api/datasets/1.0/search/",c)},facets:function(a,b){return this.search(a,{rows:0,facet:b})}},records:{analyze:function(a,b){return d(a,"/api/records/1.0/analyze/",angular.extend({},b,{dataset:a.dataset.datasetid}))},search:function(a,b){return d(a,"/api/records/1.0/search/",angular.extend({},b,{dataset:a.dataset.datasetid}))},download:function(a,b){return d(a,"/api/records/1.0/download/",angular.extend({},b,{dataset:a.dataset.datasetid}))},geo:function(a,b,c){return d(a,"/api/records/1.0/geocluster/",angular.extend({},b,{dataset:a.dataset.datasetid}),c)},geopreview:function(a,b,c){return d(a,"/api/records/1.0/geopreview/",angular.extend({},b,{dataset:a.dataset.datasetid}),c)},boundingbox:function(a,b,c){return d(a,"/api/records/1.0/boundingbox/",angular.extend({},b,{dataset:a.dataset.datasetid}),c)}},reuses:function(a,b){return d(a,"/explore/reuses/",b)}}}]),a.provider("ModuleLazyLoader",function(){var a={highcharts:{css:[],js:[["https://code.highcharts.com/3.0.10/highcharts.js"],["https://code.highcharts.com/3.0.10/modules/no-data-to-display.js"],["https://code.highcharts.com/3.0.10/highcharts-more.js"]]},leaflet:{css:["https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css","https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v0.0.3/leaflet.fullscreen.css","https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.css","libs/ods-geobox/geobox.css","libs/ods-vectormarker/vectormarker.css","libs/ods-clustermarker/clustermarker.css","libs/leaflet-label/leaflet.label.css"],js:[["L@https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"],["L.Control.FullScreen@https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v0.0.3/Leaflet.fullscreen.min.js","L.Control.Locate@https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.js","L.Label@libs/leaflet-label/leaflet.label.js","L.ODSMap@libs/ods-map/ods-map.js","L.ODSTileLayer@libs/ods-map/ods-tilelayer.js","L.Control.GeoBox@libs/ods-geobox/geobox.js","L.VectorMarker@libs/ods-vectormarker/vectormarker.js","L.ClusterMarker@libs/ods-clustermarker/clustermarker.js"]]},rome:{css:["libs/rome/rome.css"],js:["libs/rome/rome.standalone.js"]}};this.getConfig=function(){return a};var b=function(a,c){var d=c.split(".");if(a.hasOwnProperty(d[0])&&angular.isDefined(a[d[0]])){if(1===d.length)return!0;var e=a[d[0]];return d.shift(),b(e,d.join("."))}return!1},c=function(a){return b(window,a)};this.$get=["$q","ODSWidgetsConfig",function(b,d){var e={},f=[],g=function(a,c){if(angular.isDefined(e[c]))return e[c];var g=b.defer(),h="/"===c.substring(0,1)||"http://"===c.substring(0,7)||"https://"===c.substring(0,8)?c:d.basePath+c;return LazyLoad[a](h,function(){f.push(c),g.resolve()}),e[c]=g,g};return function(d){for(var e=a[d],h=[],i=0;i<e.css.length;i++)-1===f.indexOf(e.css[i])&&h.push(g("css",e.css[i]).promise);for(var j=b.defer(),k=null,l=0;l<e.js.length;l++){var m=e.js[l];angular.isArray(m)||(m=[m]);for(var n=[],o=0;o<m.length;o++){var p,q=m[o].split("@");if(q.length>1){if(c(q[0]))continue;p=q[1]}else p=q[0];-1===f.indexOf(p)&&n.push(g("js",p).promise)}k=k?k.then(function(){return b.all(n)}):b.all(n)}return k.then(function(){j.resolve()}),h.push(j.promise),b.all(h)}}]}),a.factory("DebugLogger",["$window",function(a){return{log:function(){("#debug"==a.location.hash||a.location.hash.indexOf("debug=")>=0||$(document.body).hasClass("showDebug"))&&console.log.apply(console,arguments)}}}]),a.factory("odsErrorService",function(){var a=[];return{registerForErrorNotification:function(b){a.push(b)},sendErrorNotification:function(b){angular.isString(b)&&(b={title:"Error",error:b}),angular.forEach(a,function(a){a(b)})},markErrorAsHandled:function(a){a.handled=!0}}})}(),function(){"use strict";var a=angular.module("ods-widgets");a.filter("nofollow",function(){return function(a){return angular.isString(a)?a.replace(/<a href="/g,'<a target="_blank" rel="nofollow" href="'):a}}),a.filter("prettyText",["$filter",function(a){function b(a){return a.replace(/&/g,"&amp;").replace(d,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var c=/[<>]+/,d=/([^\#-~| |!])/g;return function(d){return d&&angular.isString(d)?c.test(d)?b(d):a("linky")(d,"_blank"):d}}]),a.filter("imagify",["$sce",function(a){var b=/^(http(?:s?):\/\/[^;,]*(?:jpg|jpeg|png|gif))(?:$|\?.*|;|,|&)/i;return function(c){if(angular.isString(c)){c=c.trim();var d=b.exec(c);if(null!==d)return a.trustAsHtml('<img class="imagify" src="'+d[1]+'" />')}return c}}]),a.filter("isDefined",function(){return function(a){return angular.isDefined(a)}}),a.filter("displayImageValue",function(a){return function(b,c){if(!b)return b;var d="/explore/dataset/"+c+"/images/"+b.id+"/300/";return a.trustAsHtml('<img class="imagify" src="'+d+'" />')}}),a.filter("fieldsForVisualization",function(){var a={table:["image"],map:["geo_point_2d","geo_shape"],images:["image"]};return function(b,c){if(angular.isUndefined(b))return b;if(angular.isUndefined(a[c]))throw'Unknown visualization type "'+c+"'";return b.filter(function(b){return-1===a[c].indexOf(b.type)})}}),a.filter("formatFieldValue",["$filter",function(a){var b=function(a){if(a.annotations){var b=a.annotations.filter(function(a){return"timeserie_precision"===a.name});if(b.length>0)return b[0].args[0]}return null};return function(c,d){var e=c[d.name];if(null===e||void 0===e)return"";if("int"===d.type||"double"===d.type){var f="";if(d.annotations)for(var g=0;g<d.annotations.length;g++)"unit"===d.annotations[g].name&&(f=" "+d.annotations[g].args[0]);return a("number")(e)+f}if("geo_point_2d"===d.type)return e[0]+", "+e[1];if("geo_shape"===d.type)return angular.toJson(e);if("date"===d.type){var h=b(d);if("year"===h)return e;if("month"===h){var i=moment(e,"YYYY-MM");return a("capitalize")(a("moment")(i,"MMMM YYYY"))}return a("moment")(e,"LL")}return"datetime"===d.type?(19===e.length&&(e+="Z"),a("moment")(e,"LLL")):""+e}}]),a.filter("capitalize",[function(){return function(a){return ODS.StringUtils.capitalize(a)}}]),a.filter("truncate",function(){return function(a,b){return a&&angular.isString(a)?(b||(b=200),a.substring(0,b)):a}}),a.filter("fieldsFilter",function(){return function(a,b){if(!a)return a;if(angular.isArray(b)&&b.length){var c=[];return angular.forEach(b,function(b){var d=$.grep(a,function(a){return a.name===b})[0];angular.isDefined(d)&&c.push(d)}),c}return a}}),a.filter("moment",[function(){return function(a,b){return a?moment(a).format(b):void 0}}]),a.filter("timesince",[function(){return function(a){return a?moment(a).fromNow():void 0}}]),a.filter("themeSlug",["$filter",function(a){return function(b){return!b||angular.isArray(b)&&0===b.length?b:(angular.isArray(b)&&(b=b[0]),a("slugify")(a("normalize")(b)))}}]),a.filter("slugify",function(){return function(a){return a?ODS.StringUtils.slugify(a):a}}),a.filter("normalize",[function(){var a=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];
return function(b){if(!b)return b;for(var c=0;c<a.length;c++)b=b.replace(a[c].letters,a[c].base);return b}}]),a.filter("shortSummary",[function(){return function(a,b){if(b=b||400,!a)return"";var c="",d=angular.element("<div>"+a+"</div>");if(0===d.children().length)c=a.indexOf("\n")>-1?a.substring(0,a.indexOf("\n")):a;else{var e=d.contents()[0];if(3==e.nodeType)c=e.textContent;else if(d.find("p").length>0){var f=d.find("p")[0];c=angular.isDefined(f.textContent)?f.textContent:f.innerText}else c=d.text()}return c.length>b&&(c=c.substring(0,b-3)+""),c}}]),a.filter("imageUrl",function(){return function(a,b){if(!a||angular.equals(a,{}))return null;if(b||console.log("ERROR : This filter requires a context as second parameter."),!b.dataset)return null;angular.isObject(a)||console.log("ERROR : This field is not an image field.");var c=b.domainUrl;return c+="/api/datasets/1.0/"+b.dataset.datasetid+"/images/"+a.id+"/"}}),a.filter("thumbnailUrl",["imageUrlFilter",function(a){return function(b,c){var d=a(b,c);return d?d+"300/":null}}]),a.filter("firstValue",function(){return function(a){return angular.isArray(a)?a.length>0?a[0]:null:a}}),a.filter("split",function(){return function(a,b){if(!a)return a;b||(b=";");var c=a.split(b);return c}}),a.filter("join",function(){return function(a,b){return a?(b||(b=", "),angular.isArray(a)?a.join(b):a):a}}),a.filter("stringify",function(){return function(a){return angular.isObject(a)?JSON.stringify(a):a}})}(),function(a){var b={GeoFilter:{getBboxParameterAsBounds:function(a){var b=a.split(",");return[[b[0],b[1]],[b[2],b[3]]]},getBoundsAsBboxParameter:function(a){return angular.isArray(a)?[a[0][0],a[0][1],a[1][0],a[1][1]].join(","):[a.getSouthWest().lat,a.getSouthWest().lng,a.getNorthEast().lat,a.getNorthEast().lng].join(",")},getBoundsAsPolygonParameter:function(a){var b;b=angular.isArray(a)?new L.LatLngBounds(a):a;for(var c=[[b.getNorthWest().lat,b.getNorthWest().lng],[b.getNorthEast().lat,b.getNorthEast().lng],[b.getSouthEast().lat,b.getSouthEast().lng],[b.getSouthWest().lat,b.getSouthWest().lng]],d=[],e=0;e<c.length;e++){var f=c[e];d.push(f.join(","))}var g="("+d.join("),(")+")";return g},getPolygonParameterAsBounds:function(a){for(var b,c,d,e,f=a.replace(/[()]/g,"").split(","),g=0;g<f.length;g+=2){var h=f[g],i=f[g+1];(!b||b>h)&&(b=h),(!c||c>i)&&(c=i),(!d||h>d)&&(d=h),(!e||i>e)&&(e=i)}return[[b,c],[d,e]]},getBboxParameterAsPolygonParameter:function(a){return this.getBoundsAsPolygonParameter(this.getBboxParameterAsBounds(a))},getGeoJSONPolygonAsPolygonParameter:function(a){var b,c=[];if("LineString"===a.type)b=a.coordinates,c.push(b[0][1]+","+b[0][0]),c.push(b[0][1]+","+b[1][0]),c.push(b[1][1]+","+b[1][0]),c.push(b[1][1]+","+b[0][0]);else{b=a.coordinates[0],"MultiPolygon"===a.type&&(b=b[0]);for(var d=0;d<b.length;d++){var e=angular.copy(b[d]);e.length>2&&e.splice(2,1),e.reverse(),c.push(e.join(","))}}return"("+c.join("),(")+")"},addGeoFilterFromSpatialObject:function(a,b){if(angular.isArray(b))a["geofilter.distance"]=b[0]+","+b[1];else if("Point"===b.type)a["geofilter.distance"]=b.coordinates[1]+","+b.coordinates[0];else{var c=L.geoJson(b).getBounds();a["geofilter.polygon"]=this.getBoundsAsPolygonParameter(c)}}},StringUtils:{slugify:function(a){return a?a.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/-+/g,"-"):a},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},startsWith:function(a,b){return a&&0===a.indexOf(b)}},DatasetUtils:{isFieldSortable:function(a){var b=["int","double","date","datetime"];if(b.indexOf(a.type)>=0)return!0;if("text"===a.type&&a.annotations)for(var c=0;c<a.annotations.length;c++){var d=a.annotations[c];if("sortable"===d.name)return!0}return!1}},Dataset:function(a){var b,c,d,e=function(a,b){if(a.annotations)for(var c=0;c<a.annotations.length;c++)if(a.annotations[c].name===b)return!0;return!1},f=function(){d={facets:[]},b=[],c=0;for(var f=0;f<a.fields.length;f++){var g=a.fields[f];e(g,"facet")&&(c++,d.facets.push(g)),b[g.type]?b[g.type]+=1:b[g.type]=1}};return{datasetid:a.datasetid||"preview",has_records:a.has_records,metas:a.metas||{domain:"preview"},features:a.features,attachments:a.attachments,fields:a.fields,extra_metas:a.extra_metas,interop_metas:a.interop_metas,setFields:function(a){this.fields=a,f()},getUniqueId:function(){return this.metas.domain+"."+this.datasetid},getTypes:function(){return"undefined"==typeof b&&f(),b},hasFieldType:function(a){for(var b=0;b<this.fields.length;b++)if(this.fields[b].type==a)return!0;return!1},getFacetsCount:function(){return"undefined"==typeof c&&f(),c},hasFacet:function(){return"undefined"==typeof c&&f(),c>0},getFilterDescription:function(){return"undefined"==typeof d&&f(),d},getFacets:function(){return this.getFilterDescription().facets},setMetas:function(a){this.metas=a},getField:function(a){for(var b=0;b<this.fields.length;b++){var c=this.fields[b];if(c.name===a)return c}return null},getFieldLabel:function(a){var b=this.getField(a);return b?b.label:b},hasNumericField:function(){for(var a=0;a<this.fields.length;a++){var b=this.fields[a];if("int"===b.type||"double"===b.type)return!0}return!1}}}};"undefined"==typeof a.ODS&&(a.ODS={}),a.ODS=angular.extend(a.ODS,b)}(window),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsCatalogContext",["ODSAPI",function(a){return{restrict:"AE",scope:!0,replace:!0,link:function(b,c,d){for(var e=d.context.split(","),f=0;f<e.length;f++){var g=e[f].trim(),h=d[g+"Domain"];b[g]={name:g,type:"catalog",domain:h,domainUrl:a.getDomainURL(h),apikey:d[g+"Apikey"],parameters:b.$eval(d[g+"Parameters"])||{}}}}}}])}(),function(){"use strict";var a=angular.module("ods-widgets"),b=function(a,b,c){var d=c.find(".dataset-item").first(),e=c.find(".card-container"),f=$(e).outerHeight();"bottom"==b.position?($(d).css("top",0),$(d).css("bottom",f)):($(d).css("top",f),$(d).height(c.outerHeight()-f)),a(function(a){$(d).html(a)}),b.$apply()};a.directive("odsDatasetCard",function(){return{restrict:"E",scope:{context:"="},template:'<div class="odswidget odswidget-dataset-card"><div class="card-container" ng-class="{bottom: position == \'bottom\', expanded: expanded, expandable: isExpandable()}"><h2 class="dataset-title" ng-click="expanded = !expanded" ng-show="!expanded || (expanded && !context.dataset.metas.description)">{{context.dataset.metas.title}}</h2><div ng-click="expanded = !expanded" class="expand-control"><span translate>Details</span> <i class="icon-chevron-down" ng-show="!expanded"></i><i class="icon-chevron-up" ng-hide="!expanded"></i></div><div class="dataset-expanded" ng-click="expanded = !expanded""><h2 class="dataset-title" ng-show="expanded">{{context.dataset.metas.title}}</h2><p class="dataset-description" ng-if="expanded" ng-bind-html="safeHtml(context.dataset.metas.description)"></p></div><div class="dataset-infos"><span class="dataset-infos-text"><a ng-href="{{datasetUrl}}" target="_blank" ng-bind-html="websiteName"></a><span ng-show="context.dataset.metas.license"> - <span translate>License</span> {{context.dataset.metas.license}}</span></span></div></div><div class="dataset-item"></div></div>',replace:!0,transclude:!0,link:function(a,c,d){a.position=d.position||"top",a.renderContent=b},controller:["$scope","$element","ODSWidgetsConfig","$transclude","$sce",function(a,b,c,d,e){a.websiteName=c.websiteName,a.expanded=!1,a.safeHtml=function(a){return e.trustAsHtml(a)},a.isExpandable=function(){return a.context&&a.context.dataset&&a.context.dataset.datasetid&&a.context.dataset.metas.description?!0:!1};var f=a.$watch("context",function(c){c&&c.dataset&&(setTimeout(function(){a.renderContent(d,a,b)},0),a.expanded=!1,a.datasetUrl=a.context.domainUrl+"/explore/dataset/"+a.context.dataset.datasetid+"/",a.websiteName||(a.websiteName=a.context.domainUrl),f())},!0)}]}}),a.directive("odsMultidatasetsCard",["ODSWidgetsConfig",function(a){return{restrict:"E",scope:{title:"=",datasets:"=",context:"="},templateUrl:a.basePath+"templates/multidatasets_card.html",replace:!0,transclude:!0,link:function(a,c,d){a.position=d.position||"top",a.renderContent=b},controller:["$scope","$element","ODSWidgetsConfig","$transclude","$sce",function(a,b,c,d,e){a.datasetObjectKeys=[],a.websiteName=c.websiteName,a.safeHtml=function(a){return e.trustAsHtml(a)},a.isExpandable=function(){return a.datasetObjectKeys.length&&1!==a.datasetObjectKeys.length?!0:!1},a.tryToggleExpand=function(){a.isExpandable()&&(a.expanded=!a.expanded)};var f=a.$watch("datasets",function(c){var e=Object.keys(c);0!==e.length&&(a.datasetObjectKeys=e,setTimeout(function(){a.renderContent(d,a,b)},0),a.expanded=!1,f())},!0)}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsDatasetContext",["ODSAPI",function(a){var b=function(b,c,d,e,f,g,h){var i;if(angular.equals(g,{}))if(h){var j=d.$watch(h,function(a){a&&(d[e].parameters=a.parameters,j())});i=null}else i={};else i=g;d[e]={name:e,type:"dataset",domain:b,domainUrl:a.getDomainURL(b),apikey:f,dataset:null,parameters:i},a.datasets.get(d[e],c,{extrametas:!0,interopmetas:!0}).success(function(a){d[e].dataset=new ODS.Dataset(a)})};return{restrict:"AE",scope:!0,replace:!0,link:function(a,c,d){for(var e=d.context.split(","),f=0;f<e.length;f++){var g=e[f].trim(),h=d[g+"Dataset"],i=d[g+"Domain"];h||console.log("ERROR : Context "+g+" : Missing dataset parameter");var j=d[g+"Apikey"],k=d[g+"Sort"],l=a.$eval(d[g+"Parameters"])||{},m=d[g+"ParametersFromContext"];k&&(l.sort=k),b(i,h,a,g,j,l,m)}}}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsDisqus",["ODSWidgetsConfig","$location","$window",function(a,b,c){return{restrict:"E",replace:!0,scope:{shortname:"@",identifier:"@"},template:'<div id="disqus_thread" class="odswidget"></div>',link:function(d){c.disqus_shortname=d.shortname||a.disqusShortname,d.identifier&&(c.disqus_identifier=d.identifier),c.disqus_url=b.absUrl(),c.disqus_config=function(){this.language=a.language};var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+c.disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsDomainStatistics",["ODSAPI",function(a){return{restrict:"AE",scope:!0,controller:function(b,c){var d=function(a,b,c){return c.name===b?(a.stats[b]=c.facets.length,!0):!1},e=b.$watch(c.context,function(b){b.stats={dataset:0,keyword:0,publisher:0,theme:0},a.datasets.search(b,{facet:["keyword","publisher","theme"]}).success(function(a){if(b.stats.dataset=a.nhits,a.facet_groups)for(var c=0;c<a.facet_groups.length;c++)d(b,"keyword",a.facet_groups[c])||d(b,"publisher",a.facet_groups[c])||!d(b,"theme",a.facet_groups[c])}),e()},!0)}}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsFacetEnumerator",["ODSAPI",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{context:"=",facetName:"@"},template:'<div class="odswidget odswidget-facet-enumerator"><div class="no-data" ng-hide="items" translate>No data available yet</div><div ng-repeat="item in items" inject class="item"></div></div>',controller:["$scope",function(b){var c=b.$watch("context",function(d){var e;if("catalog"===d.type)e=a.datasets.facets(d,b.facetName);else{if("dataset"!==d.type||!d.dataset)return;e=a.records.search(b.context,{rows:0,facet:b.facetName})}e.success(function(a){b.items=a.facet_groups?a.facet_groups[0].facets:[]}),c()},!0)}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsFacets",function(a,b){var c=function(b,c,d){var e="";angular.forEach(d,function(a){e+='<ods-facet name="'+a.name+'" title="'+(a.title||a.name)+'" sort="'+(a.sort||"")+'" hide-if-single-category="'+(a.hideIfSingleCategory?"true":"false")+'" hide-category-if="'+(a.hideCategoryIf||"")+'">'+(a.template||"")+"</ods-facet>"});var f=angular.element(e);c.append(f),a(f)(b)};return{restrict:"E",replace:!0,scope:{context:"=",facetsConfig:"="},compile:function(a){var d=a.children().length;return function(a,e){if(a.facetsConfig)c(a,e,a.facetsConfig),a.init();else if(0===d)var f,g=a.$watch("context",function(){if(a.context)if(g(),"catalog"===a.context.type)f=[{name:"modified",title:b("Modified")},{name:"publisher",title:b("Publisher")},{name:"keyword",title:b("Keyword")},{name:"theme",title:b("Theme")}],c(a,e,f),a.init();else var d=a.$watch("context.dataset",function(b){b&&(d(),f=angular.copy(a.context.dataset.getFacets()),angular.forEach(f,function(a){a.title=a.label,delete a.label}),c(a,e,f),a.init())},!0)},!0);else a.init()}},controller:["$scope","ODSAPI",function(a,b){a.facets=[],a.init=function(){a.$watch(function(){var b=angular.copy(a.context.parameters);return b.sort&&delete b.sort,b.start&&delete b.start,b.tab&&delete b.tab,b.dataChart&&delete b.dataChart,"dataset"===a.context.type?[b,a.context.dataset]:b},function(){("catalog"===a.context.type||a.context.dataset)&&(angular.isDefined(a.context.parameters.start)&&delete a.context.parameters.start,a.refreshData())},!0)},a.refreshData=function(){var c=angular.extend({},a.context.parameters,{rows:0,facet:a.facets.map(function(a){return a.name})});a.facets.map(function(a){a.sort&&(c["facetsort."+a.name]=a.sort)});var d;d="dataset"===a.context.type?b.records.search(a.context,c):b.datasets.search(a.context,c),d.success(function(b){a.context.nhits=b.nhits;var c,d,e;if(angular.forEach(a.facets,function(a){a.categories.splice(0,a.categories.length)}),b.facet_groups)for(var f=0;f<b.facet_groups.length;f++)c=b.facet_groups[f],e=a.facets.filter(function(a){return a.name===c.name}),e.length>0&&(d=e[0].categories,Array.prototype.push.apply(d,c.facets))})},this.registerFacet=function(b,c){var d=[];return a.facets.push({name:b,categories:d,sort:c}),d},this.toggleRefinement=function(b,c){var d="refine."+b;if(angular.isDefined(a.context.parameters[d])){var e=angular.copy(a.context.parameters[d]);angular.isArray(e)||(e=[e]),e.indexOf(c)>-1?e.splice(e.indexOf(c),1):(angular.forEach(e,function(a,b){c.startsWith(a+"/")?e.splice(b,1):a.startsWith(c+"/")&&e.splice(b,1)}),e.push(c)),0===e.length?delete a.context.parameters[d]:a.context.parameters[d]=e}else a.context.parameters[d]=c}}]}}),a.directive("odsFacet",function(){return{restrict:"E",replace:!0,scope:{name:"@",title:"@",visibleItems:"@",hideIfSingleCategory:"@",hideCategoryIf:"@",sort:"@"},template:function(a){return a.data("facet-template",a.html()),'<div class="odswidget odswidget-facet"><h3 class="facet-title" ng-if="title && categories.length && visible()">{{title}}</h3><ods-facet-category-list ng-if="visible()" facet-name="{{ name }}" hide-category-if="{{ hideCategoryIf }}" categories="categories" template="{{ customTemplate }}"></ods-facet-category-list></div>'},require:"^odsFacets",link:function(a,b,c,d){angular.isUndefined(d)&&console.log("ERROR : odsFacet must be used within an odsFacets tag."),a.categories=d.registerFacet(a.name,a.sort),a.facetsCtrl=d},controller:["$scope","$element",function(a,b){a.visibleItemsNumber=a.visibleItems||6,this.toggleRefinement=function(b){a.facetsCtrl.toggleRefinement(a.name,b)},this.getVisibleItemsNumber=function(){return a.visibleItemsNumber},a.visible=function(){return!(angular.isString(a.hideIfSingleCategory)&&"true"===a.hideIfSingleCategory.toLowerCase()&&1===a.categories.length&&"refined"!==a.categories[0].state)},a.customTemplate=b.data("facet-template")}]}}),a.directive("odsFacetCategoryList",function(){return{restrict:"E",replace:!0,scope:{categories:"=",template:"@",facetName:"@",hideCategoryIf:"@"},require:"^odsFacet",template:'<ul class="category-list"><li ng-repeat="category in categories"><ods-facet-category ng-if="!categoryIsHidden(category)" facet-name="{{ facetName }}" category="category" template="{{template}}" ng-show="visible($index)"></ods-facet-category></li><li ng-if="visibleItems < categories.length" class="expansion-control"><a ng-hide="expanded" href="#" ng-click="toggle($event)" translate>More</a><a ng-show="expanded" href="#" ng-click="toggle($event)" translate>Less</a></li></ul>',link:function(a,b,c,d){a.expanded=!1,a.visibleItems=d.getVisibleItemsNumber(),a.visible=function(b){return a.expanded||b<a.visibleItems},a.toggle=function(b){b.preventDefault(),a.expanded=!a.expanded},a.categoryIsHidden=function(b){if(!a.hideCategoryIf)return!1;var c=a.$new(!1);return c.category=b,c.$eval(a.hideCategoryIf)}}}}),a.directive("odsFacetCategory",function(a){return{restrict:"E",replace:!0,require:"^odsFacet",scope:{category:"=",facetName:"@",template:"@"},template:'<div class="odswidget odswidget-facet-category">   <a href="#" ng-click="toggleRefinement($event, category.path)" ng-class="{\'refined\': category.state === \'refined\'}" title="{{ category.name }}">   </a></div>',link:function(b,c,d,e){b.toggleRefinement=function(a,b){a.preventDefault(),e.toggleRefinement(b)};var f=b.template||'<span class="category-name">{{ category.name }}</span> <span class="category-count">{{ category.count|number }}</span>';if(c.find("a").append(a("<div>"+f+"</div>")(b)[0]),b.category.facets){var g=angular.element('<ods-facet-category-list categories="category.facets" template="{{template}}"></ods-facet-category-list>');c.find("a").after(g),a(g)(b)}},controller:["$scope",function(){}]}})}(),function(){"use strict";angular.module("ods-widgets").directive("odsGeotooltip",["$timeout","ModuleLazyLoader",function(a,b){var c=angular.element('<div id="odswidget-geotooltip" class="odswidget" style="opacity: 0; transition: opacity 200ms ease-out; position: fixed; z-index: 40000; visibility: hidden;"></div>'),d=null,e=null,f=function(a,b,f,g,h,i){var j=!1;(b!==c.css("width")||f!==c.css("height"))&&(j=!0),c.css("width",b),c.css("height",f);var k=jQuery(window).height()-(a.offset().top-jQuery(document).scrollTop());c.height()<k?c.css("top",a.height()+a.offset().top-jQuery(document).scrollTop()+5+"px"):c.css("top",a.offset().top-jQuery(document).scrollTop()-5-c.height()+"px");var l=jQuery(window).width()-(a.offset().left-jQuery(document).scrollLeft());if(c.width()<l?c.css("left",a.offset().left-jQuery(document).scrollLeft()+"px"):c.css("left",a.offset().left-jQuery(document).scrollLeft()-c.width()+"px"),a.after(c),null===d){d=new L.map(c[0],{zoomControl:!1});var m=new L.TileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{minZoom:1,maxZoom:16,attribution:'Tiles <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png"> - Map data  <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>',subdomains:"1234"});d.addLayer(m)}else j&&d.invalidateSize();null!==e&&d.removeLayer(e),e=L.layerGroup();var n=new L.LatLngBounds;if(g){angular.isString(g)&&(g=g.split(","));var o=new L.LatLng(g[0],g[1]),p=L.marker(o);e.addLayer(p),n.extend(o)}if(h){angular.isString(h)&&(h=angular.fromJson(h));var q=L.geoJson(h);e.addLayer(q),n.extend(q.getBounds())}if(i&&angular.isDefined(i.geometry)){var q=L.geoJson(i.geometry);e.addLayer(q),n.extend(q.getBounds())}e.addTo(d),d.fitBounds(n,{reset:!0}),c.css("opacity","1"),c.css("visibility","visible")},g=function(){c.css("opacity","0"),a(function(){c.css("visibility","hidden")},200)};return{template:'<span ng-transclude style="border-bottom: 1px dotted #000000; cursor: help;" class="geotooltip"></span>',replace:!0,restrict:"E",transclude:!0,scope:{coords:"=",width:"@",height:"@",delay:"@",geojson:"=",record:"="},link:function(c,d,e){b("leaflet").then(function(){var b=(e.width||200)+"px",h=(e.height||200)+"px",i=null,j=e.delay||500;d.bind("mouseenter",function(){0===j?f(d,b,h,c.coords,c.geojson,c.record):i=a(function(){f(d,b,h,c.coords,c.geojson,c.record),i=null},j)}),d.bind("click",function(){f(d,b,h,c.coords,c.geojson,c.record),null!==i&&(a.cancel(i),i=null)}),d.bind("mouseleave",function(){g(),null!==i&&(a.cancel(i),i=null)})})}}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.factory("requestData",["ODSAPI","$q","ChartHelper","AggregationHelper",function(a,b,c){var d=function(a,b,c,d){var e={dataset:a.config.dataset,x:a.xAxis,sort:a.sort||"",maxpoints:a.maxpoints||""};if(b&&(e.precision=c,e.periodic=d),a.timescale){var f=a.timescale.split(" ");e.precision=f[0],e.periodic=2==f.length?f[1]:""}return e},e=function(a,b,d){return c.isChartSortable(b.type)?(a["y.serie"+(d+1)+".expr"]=b.yAxis,a["y.serie"+(d+1)+".func"]=b.func,a["y.serie"+(d+1)+".cumulative"]=b.cumulative||!1,"QUANTILES"===b.func&&(b.subsets||(b.subsets=50),a["y.serie"+(d+1)+".subsets"]=b.subsets)):($.each(b.charts[0],function(b,c){a["y.serie"+(d+1)+"min."+b]=c}),"QUANTILES"===b.charts[0].func&&(b.charts[0].subsets||(b.charts[0].subsets=50),a["y.serie"+(d+1)+"min.subsets"]=b.charts[0].subsets),$.each(b.charts[1],function(b,c){a["y.serie"+(d+1)+"max."+b]=c}),"QUANTILES"===b.charts[1].func&&(b.charts[1].subsets||(b.charts[1].subsets=50),a["y.serie"+(d+1)+"max.subsets"]=b.charts[1].subsets),a.sort==="serie"+(d+1)&&(a.sort="")),a};return function(c,f,g,h,i,j,k){var l=[];angular.forEach(c,function(b){var c=d(b,f,g,h);angular.forEach(b.charts,function(a,b){e(c,a,b)});var k={domain:i,domainUrl:a.getDomainURL(i),dataset:{datasetid:c.dataset},apikey:j,parameters:{}};l.push(a.records.analyze(k,angular.extend({},b.config.options,c)))}),b.all(l).then(k)}}]),a.directive("odsChart",["requestData","translate","ModuleLazyLoader","AggregationHelper","ChartHelper","$rootScope","odsErrorService",function(a,b,c,d,e,f,g){return{restrict:"A",replace:!0,scope:{parameters:"=odsChart",domain:"=",apikey:"=",colors:"="},template:'<div class="ods-chart"><div class="chartplaceholder"></div><debug data="chartoptions"></debug></div>',link:function(d,f){var h=function(){},i=f.find(".chartplaceholder");c("highcharts").then(function(){function c(a){if(!l){if(angular.isObject(a)&&("day"in a||"month"in a||"year"in a)){var c=new Date(a.year,a.month-1||0,a.day||1,a.hour||0,a.minute||0);return Highcharts.dateFormat("%Y-%m-%d",c)}return""+a}switch(console.warn("formatRowX on periodic value should not be used anymore"),l){case"month":return[b("Jan"),b("Feb"),b("Mar"),b("Apr"),b("May"),b("Jun"),b("Jul"),b("Aug"),b("Sep"),b("Oct"),b("Nov"),b("Dec")][a.month-1];case"weekday":return[b("Monday"),b("Tuesday"),b("Wednesday"),b("Thursday"),b("Friday"),b("Saturday"),b("Sunday")][a.weekday];case"day":return a.day;default:return""+a}}Highcharts.setOptions({global:{useUTC:!1}});var j,k,l,m,n,o=function(a){var b;return b=d.domain?d.domain+"."+a:e.getDatasetUniqueId(a)},p=function(a){i.height(),i.width();if(0===a.queries.length)a.xLabel="";else{var c=o(a.queries[0].config.dataset);a.xLabel=e.getXLabel(c,a.queries[0].xAxis,a.timescale)}var f={chart:{},title:{text:""},credits:{enabled:!1},colors:[],series:[],xAxis:{title:{text:a.queries.length>0?a.xLabel||a.queries[0].xAxis:""},labels:{step:1,rotation:-45,align:"right"},minPadding:0,maxPadding:0,dateTimeLabelFormats:{second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e %b %y",week:"%e. %b",month:"%b '%y",year:"%Y"}},yAxis:[],plotOptions:{columnrange:{pointPadding:0,groupPadding:0,borderWidth:0,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b>'}},arearange:{tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b>'}},areasplinerange:{tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b>'}},pie:{tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y} ({point.percentage:.1f}%)</b>'}}},tooltip:{valueDecimals:2,headerFormat:"{point.key}<br>",pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b>',formatter:function(a){var b,c=this.points||angular.isArray(this)?this:[this],d=c[0].series;return b=[a.tooltipHeaderFormatter(c[0])],angular.forEach(c,function(a){d=a.series;var c=d.tooltipFormatter&&d.tooltipFormatter(a)||a.point.tooltipFormatter(d.tooltipOptions.pointFormat);c=c.replace(/(\.|,)00</,"<"),b.push(c)}),b.push(a.options.footerFormat||""),b.join("")}},noData:{style:{fontFamily:"Open Sans",fontWeight:"normal",fontSize:"1.4em",color:"#333",opacity:"0.5"}},lang:{noData:b("No data available yet")}};if(d.chartoptions=f,a.timescale&&0===$.grep(a.queries,function(a){return a.sort}).length){j=a.timescale;var g=j.split(" ");k=g[0],l=2==g.length?g[1]:""}else j=!1,k=!1,l=!1;if(k?(f.xAxis.type="datetime",f.xAxis.maxZoom=36e5,f.chart.zoomType="xy"):f.xAxis.categories=[],"month"===l?f.xAxis.labels.format="{value: %B}":"weekday"===l?f.xAxis.labels.format="{value: %A}":"day"===l?f.xAxis.labels.format="{value: %d}":"hour"===l&&(f.xAxis.labels.format="{value: %H}"),a.singleAxis){var h="undefined"!=typeof a.yRangeMin&&""!==a.yRangeMin,m="undefined"!=typeof a.yRangeMax&&""!==a.yRangeMax;f.yAxis=[{title:{text:a.singleAxisLabel||""},type:a.singleAxisScale||"linear",min:h?a.yRangeMin:null,max:m?a.yRangeMax:null,startOnTick:h?!1:!0,endOnTick:m?!1:!0}]}return f},q=function(a,b,c){var d=o(b.config.dataset),f=e.getYLabel(d,c),g=angular.extend({},{name:f,color:c.color,type:c.type,yAxis:a.singleAxis?0:m[d][f],marker:{enabled:"scatter"===c.type,radius:3},shadow:!1,tooltip:{},data:[]},c.extras);return g=angular.extend(g,e.resolvePosition(c.position)),delete g.position,g},r=function(a,b){var d={tooltip:{}};if(angular.isObject(a.x)&&("year"in a.x||"month"in a.x||"day"in a.x||"hour"in a.x||"minute"in a.x)){d.pointPadding=0,d.groupPadding=0,d.borderWidth=0;var e="";"year"in a.x?("day"in a.x&&(e+=" %e"),"month"in a.x&&(e+=" %B"),e+=" %Y","hour"in a.x&&(e+="minute"in a.x?" %Hh%M":" %Hh")):("month"in a.x&&(e="%B"),"day"in a.x&&(e="month"in a.x?"%e %B":"%e"),"weekday"in a.x&&(e="%a"),"hour"in a.x&&(e="%Hh")),d.tooltip.xDateFormat=e,"month"in a.x&&(d.pointRange=26352e5),"day"in a.x&&(d.pointRange=864e5),"weekday"in a.x&&(d.pointRange=864e5),"hour"in a.x&&(d.pointRange=36e5)}else b.xAxis.categories.push(c(a.x));return d},s=function(a,b){var c=b?b.getFullYear():2e3,d=b?b.getMonth():0,e=b?b.getDate():1,f=b?b.getHours():0,g=b?b.getMinutes():0;if(angular.isObject(a.x)&&("year"in a.x||"month"in a.x||"day"in a.x||"hour"in a.x||"minute"in a.x)){var h=new Date(a.x.year||c,a.x.month-1||0,a.x.day||1,a.x.hour||0,a.x.minute||0);return!1 in a.x&&h.setMonth(d),!1 in a.x&&h.setDate(e),!1 in a.x&&h.setHours(f),!1 in a.x&&h.setMinutes(g),h.setFullYear(a.x.year||c),"year"in a.x||"weekday"in a.x&&h.setDate(h.getDate()-(h.getDay()-1)+a.x.weekday),"day"in a.x?29==a.x.day&&2==a.x.month&&(h.setDate(28),h.setMonth(1)):"month"in a.x&&h.setDate(16),h}};(h=function(t){function u(a,b){return"QUANTILES"===b.func&&b.subsets?a[b.subsets+".0"]:"undefined"==typeof a?null:a}if("undefined"==typeof t&&(t=d.parameters),t=angular.copy(t),n!==angular.toJson(t)){if(!t||!t.queries||0===t.queries.length)return void(d.chart&&angular.element(d.chart.container).empty());j=void 0,k=void 0,l=void 0,m={};for(var v=0;v<t.queries.length;v++)try{o(t.queries[v].config.dataset)}catch(w){return void e.onLoad(h)}n=angular.toJson(t);var x=p(t);angular.forEach(t.queries,function(a){var b=o(a.config.dataset);m[b]={},angular.forEach(a.charts,function(c){var d=e.getYLabel(b,c);if(!t.singleAxis&&angular.isUndefined(m[b][d])){var f="undefined"!=typeof c.yRangeMin&&""!==c.yRangeMin,g="undefined"!=typeof c.yRangeMax&&""!==c.yRangeMax;m[b][d]=x.yAxis.push({title:{text:d,style:{color:c.color}},labels:{style:{color:c.color}},type:c.scale||"linear",min:f?c.yRangeMin:null,max:g?c.yRangeMax:null,startOnTick:f?!1:!0,endOnTick:g?!1:!0,opposite:!!(x.yAxis.length%2)})-1}x.series.push(q(t,a,c)),"bar"==c.type&&(x.xAxis.labels.rotation=0),x.colors.push(c.color)})}),a(t.queries,j,k,l,d.domain,d.apikey,function(a){var e,h=0;if(k)for(var j=0;j<a.length;j++)for(var l=a[j],m=0;m<l.data.length;m++){var n=l.data[m];if(n.x.year){var o=new Date(n.x.year,n.x.month-1||0,n.x.day||1,n.x.hour||0,n.x.minute||0);o.setFullYear(n.x.year),(void 0===e||e>o)&&(e=o)}}angular.forEach(a,function(a,b){for(var f=t.queries[b].charts.length,g=0;g<a.data.length;g++){var i,j=a.data[g],l=r(j,x),m=s(j,e);i=m&&k?m.getTime():m?Highcharts.dateFormat(l.tooltip.xDateFormat,m):""+j.x;for(var n=0;f>n;n++){var o=h+n,p=t.queries[b].charts[n],q=x.series[o];if(q=angular.extend(q,l),"datetime"===x.xAxis.type)if(["arearange","areasplinerange","columnrange"].indexOf(q.type)>=0){var v=u(j["serie"+(n+1)+"min"],p.charts[0]),w=u(j["serie"+(n+1)+"max"],p.charts[1]);q.data.push("logarithmic"===d.parameters.singleAxisScale&&(0>=v||0>=w)?[i,null,null]:[i,v,w])}else if("pie"==q.type)q.data.push([Highcharts.dateFormat(l.tooltip.xDateFormat,new Date(m)),u(j["serie"+(n+1)],p)]);else{var y=u(j["serie"+(n+1)],p);q.data.push("logarithmic"===d.parameters.singleAxisScale&&0>=y?[i,null]:[i,y])}else if("pie"==q.type)q.data.push([c(j.x),u(j["serie"+(n+1)],p)]);else if(["arearange","areasplinerange","columnrange"].indexOf(q.type)>=0){var v=u(j["serie"+(n+1)+"min"],p.charts[0]),w=u(j["serie"+(n+1)+"max"],p.charts[1]);q.data.push("logarithmic"===d.parameters.singleAxisScale&&(0>=v||0>=w)?[null,null]:[v,w])}else{var y=u(j["serie"+(n+1)],p);q.data.push("logarithmic"===d.parameters.singleAxisScale&&0>=y?null:y)}}}h+=f}),d.chart&&x.chart.renderTo&&(d.chart.destroy(),i=f.find(".chartplaceholder")),x.chart.renderTo=i[0];try{d.chart=new Highcharts.Chart(x,function(){})}catch(p){p.indexOf&&0===p.indexOf("Highcharts error #19")?(g.sendErrorNotification(b("There was too many points to display, the maximum number of points has been decreased.")),angular.forEach(d.parameters.queries,function(a){a.maxpoints=20})):g.sendErrorNotification(angular.isString(p)?p:p.message)}})}})()}),d.$on("chartConfigReady",function(a,b){h(b)}),d.updateChart=h}}}]),a.directive("odsHighcharts",function(){var a=["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"];return{restrict:"E",scope:{context:"=",fieldX:"@",expressionY:"@",functionY:"@",timescale:"@",chartType:"@",color:"@",chartConfig:"=",labelX:"@",labelY:"@",sort:"@",maxpoints:"@"},replace:!0,template:'<div class="odswidget odswidget-highcharts"><div ods-chart="chart" domain="context.domain" apikey="context.apikey"></div></div>',controller:["$scope","ODSWidgetsConfig","ChartHelper",function(b,c,d){var e=c.chartColors||a;b.color&&(e=b.color.split(",").map(function(a){return a.trim()}));var f=b.$watch("context.dataset",function(a){if(a){if("dataset"!==b.context.type&&console.error("ods-highcharts requires a Dataset Context"),b.context.dataset.metas.domain=b.context.domain,d.init(b.context.dataset),angular.isUndefined(b.chartConfig)){var c={};"pie"===b.chartType&&(c={colors:e});var g="";g="y"===b.sort?"serie1":"-y"===b.sort?"-serie1":b.sort;var h=b.labelY||("COUNT"===b.functionY.toUpperCase()?"Count":b.expressionY);b.chart={timescale:b.timescale,xLabel:b.labelX,queries:[{config:{dataset:b.context.dataset.datasetid,options:b.context.parameters},xAxis:b.fieldX,sort:g,maxpoints:b.maxpoints||50,charts:[{yAxis:b.expressionY,yLabel:h,func:b.functionY,color:e[0],type:b.chartType,extras:c}]}]}}else b.chart=angular.isString(b.chartConfig)?JSON.parse(b64_to_utf8(b.chartConfig)):b.chartConfig;b.$broadcast("chartConfigReady",b.chart),b.$watch("chart",function(a){(a||ov)&&b.$broadcast("chartConfigReady",b.chart)},!0),f()}})}]}}),a.directive("odsMultiHighcharts",["ODSAPI","ChartHelper","$q",function(a,b,c){return{restrict:"E",scope:{context:"=",chartConfig:"="},replace:!0,template:'<div class="odswidget odswidget-multihighcharts"><div ods-chart="chart" domain="context.domain" apikey="context.apikey"></div></div>',controller:["$scope",function(d){var e=d.$watch("context",function(f){if(f){"catalog"!==f.type&&console.error("ods-multi-highcharts requires a Catalog Context");var g;g=angular.isString(d.chartConfig)?JSON.parse(b64_to_utf8(d.chartConfig)):d.chartConfig;for(var h=[],i=0;i<g.queries.length;i++){var j=g.queries[i].config.dataset;-1===h.indexOf(j)&&h.push(j)}for(var k=[],i=0;i<h.length;i++)k.push(a.datasets.get(d.context,h[i],{extrametas:!0}).success(function(a){var c=new ODS.Dataset(a);
c.metas.domain=d.context.domain,b.init(c)}));c.all(k).then(function(){d.chart=g,d.$broadcast("chartConfigReady",d.chart)}),e()}})}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsLastDatasetsFeed",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-last-datasets-feed"><ul>   <li class="no-data" ng-hide="datasets" translate>No data available yet</li>   <li ng-repeat="dataset in datasets" ng-if="datasets">       <ods-theme-picto theme="{{dataset.metas.theme}}"></ods-theme-picto>       <div class="dataset-details">           <div class="title"><a ng-href="{{context.domainUrl}}/explore/dataset/{{dataset.datasetid}}/" target="_self">{{ dataset.metas.title }}</a></div>           <div class="modified"><i class="icon-calendar"></i> <span title="{{ dataset.metas.modified|moment:\'LLL\' }}"><span translate>Modified</span> {{ dataset.metas.modified|timesince }}</span></div>       </div>   </li></ul></div>',scope:{context:"="},controller:["$scope",function(b){var c=function(){a.datasets.search(b.context,{rows:5,sort:"modified"}).success(function(a){b.datasets=a.datasets})};b.$watch("context",function(){c()})}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsLastReusesFeed",["ODSAPI",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="odswidget odswidget-last-reuses-feed"><ul>   <li class="no-data" ng-hide="reuses" translate>No data available yet</li>   <li ng-repeat="reuse in reuses" ng-if="reuses" inject>       <div class="reuse-thumbnail">           <span style="display: inline-block; height: 100%; vertical-align: middle;"></span>           <a ng-href="{{reuse.url}}" target="_self"><img ng-if="reuse.thumbnail" ng-src="{{ reuse.thumbnail }}"></a>       </div>       <div class="reuse-details">           <div class="title"><a ng-href="{{reuse.url}}" target="_self">{{ reuse.title }}</a></div>           <div class="dataset"><a ng-href="{{reuse.url}}" target="_self">{{ reuse.dataset.title }}</a></div>           <div class="modified"><span title="{{ reuse.created_at|moment:\'LLL\' }}"><i class="icon-calendar"></i> {{ reuse.created_at|timesince }}</span></div>       </div>   </li></ul></div>',scope:{context:"=",max:"@"},controller:["$scope",function(b){b.max=b.max||5;var c=function(){a.reuses(b.context,{rows:b.max}).success(function(a){angular.forEach(a.reuses,function(a){a.url=b.context.domainUrl+"/explore/dataset/"+a.dataset.id+"/"}),b.reuses=a.reuses})};b.$watch("context",function(){c()})}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsMap",["ModuleLazyLoader",function(a){return{restrict:"E",scope:{context:"=",embedMode:"@",autoResize:"@",mapContext:"=?",location:"@",basemap:"@",isStatic:"@",showFilters:"@",itemClickContext:"=",colorBy:"@",colorByContext:"=",colorByAggregationKey:"@",colorByKey:"@",colorByExpression:"@",colorByFunction:"@",colorByRanges:"@",colorByRangesColors:"@"},replace:!0,template:function(a){return a.contents().wrapAll("<div>"),a.contents().length>0&&a.contents().html().trim().length>0&&(a.contents().wrapAll("<div>"),a.data("tooltip-template",a.children().html())),'<div class="odswidget odswidget-map"><div class="map"></div><div class="overlay map opaque-overlay" ng-show="pendingRequests.length && initialLoading"><spinner class="spinner"></spinner></div></div>'},link:function(b,c){function d(){$(".odswidget-map > .map").length>0&&$(".odswidget-map > .map").height(Math.max(200,$(window).height()-$(".odswidget-map > .map").offset().top))}angular.isUndefined(b.mapContext)&&(b.mapContext={},b.location&&(b.mapContext.location=b.location),b.basemap&&(b.mapContext.basemap=b.basemap)),"true"===b.autoResize&&($(window).on("resize",d),d()),a("leaflet").then(function(){L.Control.FilterByView=L.Control.extend({options:{position:"topright"},onAdd:function(){var a="leaflet-control-filterview",c=a+" leaflet-bar leaflet-control",d=L.DomUtil.create("div",c),e=L.DomUtil.create("a","leaflet-bar-part",d);return e.href="#",b.mapViewFilter&&(d.className=c+" active"),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",function(){return b.$apply(function(a){a.mapViewFilter=!a.mapViewFilter}),d.className=b.mapViewFilter?c+" active":c,!1}).on(e,"dblclick",L.DomEvent.stopPropagation),b.$watch("mapViewFilter",function(a,b){a!==b&&(d.className=a?c+" active":c)}),d}}),b.initMap=function(a,d,e,f,g,h,i,j){var k={basemapsList:e,worldCopyJump:!0,minZoom:2,basemap:h,dragging:!i,zoomControl:!i,prependAttribution:j};i&&(k.doubleClickZoom=!1,k.scrollWheelZoom=!1);var l=new L.ODSMap(c.children()[0],k);l.addControl(new L.Control.Scale),"true"!==d&&("true"===b.showFilters&&l.addControl(new L.Control.FilterByView),l.addControl(new L.Control.Fullscreen)),g&&!i&&l.addControl(new L.Control.GeoBox({placeholder:f("Find a place...")})),i||l.addControl(new L.Control.Locate({maxZoom:18})),l.on("popupclose",function(a){jQuery(a.popup.getContent()).trigger("popupclose")}),b.map=l}})},controller:["$scope","$http","$compile","$q","$filter","$element","translate","ODSAPI","DebugLogger","ODSWidgetsConfig","$attrs",function(a,b,c,d,e,f,g,h,i,j,k){i.log("init map"),a.pendingRequests=b.pendingRequests,a.initialLoading=!0,(a.itemClickMapField&&!a.itemClickContextField||!a.itemClickMapField&&a.itemClickContextField)&&console.log("ERROR: You need to configure both item-click-context-field and item-click-map-field.");var l,m=null,n=null,o={delimiter:",",accuracy:5,formatLatLng:function(a){var b=L.Util.formatNum(a.lat,this.accuracy),c=L.Util.formatNum(a.lng,this.accuracy);return new L.latLng(b,c)},getLocationParameterAsArray:function(a){return a.split(this.delimiter)},getLocationParameterFromMap:function(a){var b=this.formatLatLng(a.getCenter());return a.getZoom()+this.delimiter+b.lat+this.delimiter+b.lng},getCenterFromLocationParameter:function(a){var b=this.getLocationParameterAsArray(a);return new L.latLng(b[1],b[2])},getZoomFromLocationParameter:function(a){return this.getLocationParameterAsArray(a)[0]}},p=function(a,b){ODS.GeoFilter.addGeoFilterFromSpatialObject(a.parameters,b)},q=function(a,b,c,d){angular.isDefined(d.fields[b])&&(a.parameters["refine."+c]=d.fields[b])},r=function(b,c,d,e,f){if(c||d)if(f)a.$apply(function(){q(b,c,d,f)});else{var g={};ODS.GeoFilter.addGeoFilterFromSpatialObject(g,e),jQuery.extend(g,a.staticSearchOptions,a.context.parameters,{rows:1}),h.records.download(a.context,g).success(function(a){q(b,c,d,a[0])})}else a.$apply(function(){p(b,e)})},s=function(b,d,e,g){var h,i,j;if(a.itemClickContext)angular.isArray(a.itemClickContext)?angular.forEach(a.itemClickContext,function(a){i=k["itemClick"+ODS.StringUtils.capitalize(a.name)+"ContextField"],h=k["itemClick"+ODS.StringUtils.capitalize(a.name)+"MapField"],r(a,h,i,d,g)}):(j=a.itemClickContext,i=k["itemClick"+ODS.StringUtils.capitalize(j.name)+"ContextField"]||k.itemClickContextField,h=k["itemClick"+ODS.StringUtils.capitalize(j.name)+"MapField"]||k.itemClickMapField,r(j,h,i,d,g));else{var l=a.$new(!1);e?l.recordid=e:l.shape=d;var m={offset:[0,-30],maxWidth:250,minWidth:250,autoPanPaddingTopLeft:[50,305],autoPan:!a.mapViewFilter&&!a.staticMap},n=f.data("tooltip-template");(angular.isUndefined(n)||!angular.isString(n)||""===n.trim())&&(n=a.context.dataset.extra_metas&&a.context.dataset.extra_metas.visualization&&a.context.dataset.extra_metas.visualization.map_tooltip_html?a.context.dataset.extra_metas.visualization.map_tooltip_html:""),l.template=n;var o=new L.Popup(m).setLatLng(b).setContent(c('<geo-scroller shape="shape" context="context" recordid="recordid" map="map" template="{{template}}"></geo-scroller>')(l)[0]);o.openOn(a.map)}},t=function(a){return a=Math.round(100*a)/100,a=e("number")(a)},u=function(b){return function(c,d){if(c.count>1){var e=new L.ClusterMarker(c.cluster_center,{geojson:c.cluster,value:c.count,total:d,numberFormattingFunction:t,color:a.markerColor});a.staticMap||e.on("click",function(b){a.map.getZoom()===a.map.getMaxZoom()?s(marker.getLatLng(),c.cluster):a.$apply(function(){if(c.cluster)if("Point"===c.cluster.type)a.map.fitBounds([[c.cluster.coordinates[1],c.cluster.coordinates[0]],[c.cluster.coordinates[1],c.cluster.coordinates[0]]]);else{var d={},e=ODS.GeoFilter.getBoundsAsPolygonParameter(L.geoJson(c.cluster).getBounds());jQuery.extend(d,a.staticSearchOptions,a.context.parameters,{"geofilter.polygon":e}),h.records.boundingbox(a.context,d).success(function(b){a.map.fitBounds([[b.bbox[1],b.bbox[0]],[b.bbox[3],b.bbox[2]]])})}else a.map.setView(b.latlng,a.map.getZoom()+2)})}),b.addLayer(e)}else{var f=n(c.cluster_center);f.on("click",function(a){s(a.target.getLatLng(),c.cluster)}),b.addLayer(f)}}},v=function(b){var c={"geofilter.polygon":ODS.GeoFilter.getBoundsAsPolygonParameter(a.map.getBounds()),clusterprecision:a.map.getZoom(),clusterdistance:50,return_polygons:b};jQuery.extend(c,a.staticSearchOptions,a.context.parameters),a.currentClusterRequestCanceler&&a.currentClusterRequestCanceler.resolve(),a.currentClusterRequestCanceler=d.defer(),h.records.geo(a.context,c,a.currentClusterRequestCanceler.promise).success(function(b){var c=b.clusters;a.records=c?c.length:0;for(var d=new L.LayerGroup,e=u(d),f=0;f<c.length;f++){var g=c[f];e(g,b.count.max)}d.addTo(a.map),a.layerGroup&&a.map.removeLayer(a.layerGroup),a.layerGroup=d,a.initialLoading=!1,a.currentClusterRequestCanceler=null})},w=function(){var b={"geofilter.polygon":ODS.GeoFilter.getBoundsAsPolygonParameter(a.map.getBounds()),clusterprecision:a.map.getZoom()};jQuery.extend(b,a.staticSearchOptions,a.context.parameters),b.rows=1e3,a.currentClusterRequestCanceler&&a.currentClusterRequestCanceler.resolve(),a.currentClusterRequestCanceler=d.defer(),h.records.geopreview(a.context,b,a.currentClusterRequestCanceler.promise).success(function(b){for(var c=new L.LayerGroup,d=0;d<b.length;d++)x(c,b[d]);c.addTo(a.map),a.layerGroup&&a.map.removeLayer(a.layerGroup),a.layerGroup=c,a.initialLoading=!1,a.currentClusterRequestCanceler=null})},x=function(a,b){var c={radius:3,fillColor:"#0033ff",color:"#0000ff",weight:1,opacity:1,fillOpacity:.5},d=new L.GeoJSON(b.geometry,{pointToLayer:function(a,b){return L.circleMarker(b,c)}});a.addLayer(d),d.on("click",function(a){s(a.latlng,b.geometry,b.id)})},y=function(a){var b;for(b=0;b<l.ranges.length;b++)if(a<l.ranges[b])return l.colors[b];return l.colors[l.colors.length-1]},z=function(){var b=angular.extend({},l.context.parameters,{"join.geo.remotedataset":a.context.dataset.datasetid,"join.geo.localkey":l.localkey,"join.geo.remotekey":l.remotekey,"y.agg.expr":l.expr,"y.agg.func":l.func}),c=new L.LayerGroup,d=new L.LatLngBounds,e=new L.FeatureGroup;h.records.analyze(l.context,b).success(function(b){angular.forEach(b,function(a){var b=a.x,f=a.agg;angular.forEach(b,function(a){B(a,c,d,e,y(f))})}),a.layerGroup&&a.map.removeLayer(a.layerGroup),c.addLayer(e),c.addTo(a.map),a.layerGroup=c,a.initialLoading=!1})},A=function(){var b={};b["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(a.map.getBounds()),jQuery.extend(b,a.staticSearchOptions,a.context.parameters),i.log("map -> download"),h.records.download(a.context,b).success(function(b){a.records=b,a.error="",a.nhits=b.length;for(var c=new L.LayerGroup,d=new L.LatLngBounds,e=new L.FeatureGroup,f=0;f<b.length;f++){var g=b[f];B(g,c,d,e)}a.layerGroup&&a.map.removeLayer(a.layerGroup),c.addLayer(e),c.addTo(a.map),a.layerGroup=c,a.initialLoading=!1}).error(function(b){a.error=b.error,a.initialLoading=!1})},B=function(a,b,c,d,e){var f;if(m){if(!a.fields[m])return;f=a.fields[m],"Point"===f.type&&angular.isDefined(a.geometry)&&(f=a.geometry)}else{if(!a.geometry)return;f=a.geometry}if("Point"==f.type){var g=new L.LatLng(f.coordinates[1],f.coordinates[0]),h=n(g,e);h.on("click",function(b){s(b.target.getLatLng(),f,null,a)}),d.addLayer(h),c.extend(g)}else{var i;i=e?new L.GeoJSON(f,{style:function(){return{color:e}}}):new L.GeoJSON(f),i.on("click",function(){s(L.latLng(a.geometry.coordinates[1],a.geometry.coordinates[0]),f,a.recordid,a)}),b.addLayer(i),c.extend(i.getBounds())}};a.$watch("context.parameters",function(b,c){return b===c||a.initialLoading?void 0:(i.log("map -> searchOptions watch -> refresh records"),!b["geofilter.polygon"]&&c["geofilter.polygon"]?void(a.mapViewFilter=!1):!c["geofilter.polygon"]&&b["geofilter.polygon"]?void(a.mapViewFilter=!0):void C(a.mapViewFilter?!1:!0))},!0),"aggregation"===a.colorBy&&a.$watch("colorByContext.parameters",function(){a.map&&C(!1)},!0),a.$watch("mapContext.location",function(){a.map&&C(!1)},!0);var C=function(b){var c=200,d=5e5,e=5e5,f=function(b){"aggregation"===a.colorBy?z():b.count<c||a.map.getZoom()===a.map.getMaxZoom()?A():b.count<d?b.geometries.Point&&b.geometries.Point>b.count/2?v(b.count<=e):w():v(b.count<=e)},g={without_bbox:!b};b||(g["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(a.map.getBounds())),jQuery.extend(g,a.staticSearchOptions,a.context.parameters),h.records.boundingbox(a.context,g).success(function(c){if(b)if(c.bbox.length>0){var d=a.map.getBounds();a.map.fitBounds([[c.bbox[1],c.bbox[0]],[c.bbox[3],c.bbox[2]]]);var e=a.map.getBounds();angular.equals(d,e)&&f(c)}else f(c);else f(c)})},D=function(b){var c=b.getSize();c.x>0&&c.y>0&&(a.mapContext.location=o.getLocationParameterFromMap(b),a.mapViewFilter&&(a.context.parameters["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(b.getBounds())))},E=a.$watch("[context.dataset, colorByContext.dataset]",function(b){if(b[0]&&b[0].datasetid&&("aggregation"!==a.colorBy||b[1]&&b[1].datasetid)){"aggregation"===a.colorBy&&(l={context:a.colorByContext,localkey:a.colorByAggregationKey||a.colorByKey,remotekey:a.colorByKey,expr:a.colorByExpression,func:a.colorByFunction,ranges:a.colorByRanges.split(","),colors:a.colorByRangesColors.split(",")}),b=b[0],a.mapViewFilter=a.context.parameters["geofilter.polygon"]?!0:!1,a.staticMap="true"===a.isStatic||"true"===a.context.parameters.static;var c=a.$watch("initMap",function(){a.initMap&&(c(),a.initMap(b,a.embedMode,j.basemaps,g,j.mapGeobox,a.mapContext.basemap,a.staticMap,j.mapPrependAttribution))});E(),a.staticSearchOptions={rows:a.recordLimit,dataset:a.context.dataset.datasetid,format:"json"};for(var e=0;e<b.fields.length;e++){var f=b.fields[e];if("geo_shape"===f.type){m=f.name;break}}var k={};b.extra_metas&&b.extra_metas.visualization&&(k=b.extra_metas.visualization),a.markerColor=k.map_marker_color||"#29398C",n=function(b,c){return new L.VectorMarker(b,{color:c||a.markerColor,icon:k.map_marker_picto||"icon-circle",marker:!k.map_marker_hidemarkershape})},i.log("map -> dataset watch -> refresh records");var p=a.$watch("map",function(b){if(b){a.$watch("mapViewFilter",function(b,c){b!==c&&(b?a.context.parameters["geofilter.polygon"]=ODS.GeoFilter.getBoundsAsPolygonParameter(a.map.getBounds()):a.context.parameters["geofilter.polygon"]&&delete a.context.parameters["geofilter.polygon"])});var c=function(){var b=d.defer();if(a.context.parameters.mapviewport)"("===a.context.parameters.mapviewport.substring(0,1)&&(a.context.parameters.mapviewport=ODS.GeoFilter.getBoundsAsBboxParameter(ODS.GeoFilter.getPolygonParameterAsBounds(a.context.parameters.mapviewport))),b.resolve(ODS.GeoFilter.getBboxParameterAsBounds(a.context.parameters.mapviewport));else if(a.context.parameters["geofilter.polygon"])b.resolve(ODS.GeoFilter.getPolygonParameterAsBounds(a.context.parameters["geofilter.polygon"]));else{var c={};jQuery.extend(c,a.staticSearchOptions,a.context.parameters),h.records.boundingbox(a.context,c).success(function(a){b.resolve(a.count>0?[[a.bbox[1],a.bbox[0]],[a.bbox[3],a.bbox[2]]]:[[-60,-180],[80,180]])})}return b.promise},e=function(){var e=d.defer();if(a.mapContext.location){i.log("Location found");var f=o.getCenterFromLocationParameter(a.mapContext.location),g=o.getZoomFromLocationParameter(a.mapContext.location);i.log(f,g),b.setView(f,g),C(!1),e.resolve()}else i.log("Use boundsRetrieval"),c(a.context.dataset).then(function(c){a.context.parameters.mapviewport&&(i.log("Deleted mapviewport"),delete a.context.parameters.mapviewport),i.log(c),b.fitBounds(c),e.resolve()});return e.promise};e().then(function(){i.log("First onViewportMove"),D(a.map),a.map.on("moveend",function(b){D(b.target),a.$$phase||a.$root.$$phase||a.$apply()})}),j.basemaps.length>1&&a.map.on("baselayerchange",function(b){a.mapContext.basemap=b.layer.basemapId,a.$$phase||a.$root.$$phase||a.$apply()}),p()}})}},!0)}]}}]),a.directive("geoScroller",["$compile","$templateCache",function(a,b){return{restrict:"E",transclude:!0,template:'<div class="odswidget-geo-scroller"><spinner ng-hide="records"></spinner><h2 ng-show="records.length > 1" class="scroller-control ng-leaflet-tooltip-cloak"><i class="icon-chevron-left" ng-click="moveIndex(-1)"></i><span ng-bind="(selectedIndex+1)+\'/\'+records.length" ng-click="moveIndex(1)"></span><i class="icon-chevron-right" ng-click="moveIndex(1)"></i></h2><div class="ng-leaflet-tooltip-cloak limited-results" ng-show="records && records.length == RECORD_LIMIT" translate>(limited to the first {{RECORD_LIMIT}} records)</div><div ng-repeat="record in records" ng-show="$index == selectedIndex" class="map-tooltip"><div ng-if="!template" ng-include src="safeDefaultTemplateUrl()"></div><div ng-if="template" ng-include src="\'custom-tooltip-\'+context.dataset.datasetid"></div></div></div>',scope:{shape:"=",context:"=",recordid:"=",map:"=",template:"@"},replace:!0,link:function(a,c,d){c.bind("popupclose",function(){a.$destroy()}),a.unCloak=function(){jQuery(".ng-leaflet-tooltip-cloak",c).removeClass("ng-leaflet-tooltip-cloak")},d.template&&""!==d.template&&b.put("custom-tooltip-"+a.context.dataset.datasetid,d.template)},controller:["$scope","$filter","ODSAPI","ODSWidgetsConfig","$sce",function(a,b,c,d,e){a.RECORD_LIMIT=100,a.records=[],a.selectedIndex=0,a.moveIndex=function(b){var c=(a.selectedIndex+b)%a.records.length;0>c&&(c=a.records.length+c),a.selectedIndex=c},a.safeDefaultTemplateUrl=function(){return e.trustAsResourceUrl(d.basePath+"templates/geoscroller_tooltip.html")};var f={format:"json",rows:a.RECORD_LIMIT};a.recordid?f.q="recordid:'"+a.recordid+"'":ODS.GeoFilter.addGeoFilterFromSpatialObject(f,a.shape);var g=function(){var b={};angular.extend(b,a.context.parameters,f),c.records.download(a.context,b).success(function(b){b.length>0?(a.selectedIndex=0,a.records=b,a.unCloak()):a.map.closePopup()})};a.$watch("searchOptions",function(){g()}),a.$apply(),a.getTitle=function(b){if(a.context.dataset.extra_metas&&a.context.dataset.extra_metas.visualization&&a.context.dataset.extra_metas.visualization.map_tooltip_title){var c=a.context.dataset.extra_metas.visualization.map_tooltip_title;if(angular.isDefined(b.fields[c])&&""!==b.fields[c])return b.fields[c]}return null}}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsMostPopularDatasets",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-most-popular-datasets"><ul>   <li class="no-data" ng-hide="datasets" translate>No data available yet</li>   <li ng-repeat="dataset in datasets" ng-if="datasets">       <ods-theme-picto theme="{{dataset.metas.theme}}"></ods-theme-picto>       <div class="dataset-details">           <div class="title"><a ng-href="{{context.domainUrl}}/explore/dataset/{{dataset.datasetid}}/" target="_self">{{ dataset.metas.title }}</a></div>           <div class="count"><i class="icon-download-alt"></i> {{ dataset.extra_metas.explore.download_count }} '+"<span ng-pluralize count=\"dataset.extra_metas.explore.download_count\" translate=\"when\" when=\"{'0': 'download', '1': 'download', 'other': 'downloads'}\"></span></div>       </div>   </li></ul></div>",scope:{context:"="},controller:["$scope",function(b){var c=function(){a.datasets.search(b.context,{rows:5,sort:"explore.download_count",extrametas:!0}).success(function(a){b.datasets=a.datasets})};b.$watch("context",function(){c()})}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsMostUsedThemes",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-most-used-themes"><ul>   <li class="no-data" ng-hide="themes" translate>No data available yet</li>   <li ng-repeat="theme in themes" ng-if="themes">       <div class="dataset-details">           <div class="name"><a ng-href="{{ context.domainUrl }}/explore/?refine.theme={{ theme.path }}" target="_self">{{ theme.name }}</a></div>           <div class="count"><i class="icon-table"></i> <span translate>Used by</span> {{ theme.count }} '+"<span ng-pluralize count=\"theme.count\" translate=\"when\" when=\"{'0': 'dataset', '1': 'dataset', 'other': 'datasets'}\"></span></div>       </div>   </li></ul></div>",scope:{context:"="},controller:["$scope",function(b){var c=function(){a.datasets.facets(b.context,"theme").success(function(a){a.facet_groups&&(b.themes=a.facet_groups[0].facets.slice(0,5))})};b.$watch("context",function(){c()})}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsResultEnumerator",["ODSAPI",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{context:"=",max:"@?",showHitsCounter:"@?"},template:'<div class="odswidget odswidget-result-enumerator"><div ods-results="items" ods-results-context="context" ods-results-max="{{max}}"><div ng-if="!items.length" class="no-results" translate>No results</div><div ng-if="items.length && hitsCounter" class="results-count">{{items.length}} <span translate>results</span></div><div ng-repeat="item in items" inject class="item"></div></div></div>',controller:["$scope",function(a){a.max=a.max||10,a.hitsCounter=angular.isString(a.showHitsCounter)&&"true"===a.showHitsCounter.toLowerCase()}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsResults",["ODSAPI",function(a){return{restrict:"A",scope:!0,priority:1001,controller:["$scope","$attrs",function(b,c){b.$watch(c.odsResultsContext,function(d){var e=angular.extend({},d.parameters,{rows:c.odsResultsMax}),f=c.odsResults||"results";"catalog"===d.type?(angular.extend(e,{extrametas:"true",interopmetas:"true"}),a.datasets.search(d,e).success(function(a){b[f]=a.datasets})):"dataset"===d.type&&d.dataset&&a.records.search(d,e).success(function(a){b[f]=a.records})},!0)}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsReuses",["ODSAPI","ODSWidgetsConfig","$sce",function(a,b,c){return{restrict:"E",replace:!0,templateUrl:c.trustAsResourceUrl(b.basePath+"templates/reuses.html"),scope:{context:"="},controller:["$scope",function(b){var c=!1,d=!1,e=0,f=1,g=20;b.reuses=[],b.loadMore=function(){if(b.reuses.length&&!c&&!d){d=!0;var h=f*g;a.reuses(b.context,{rows:g,start:h}).success(function(a){b.reuses=b.reuses.concat(a.reuses),c=(f+1)*g>=e,f++,d=!1}).error(function(){d=!1})}};var h=function(){d=!0,a.reuses(b.context,{rows:g}).success(function(a){b.reuses=a.reuses,c=g>=a.nhits,e=a.nhits,d=!1}).error(function(){d=!1})};b.$watch("context",function(){h()})}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsSearchbox",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-searchbox"><form method="GET" action="{{ actionUrl }}"><input class="searchbox" name="q" type="text" placeholder="{{placeholder}}"></form></div>',scope:{placeholder:"@",context:"="},controller:["$scope","$sce",function(a,b){a.actionUrl="/explore/";var c=a.$watch("context",function(d){d&&(a.actionUrl=b.trustAsResourceUrl(a.context.domainUrl+a.actionUrl),c())})}]}})}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsTable",["ODSWidgetsConfig","$sce",function(a,b){return{restrict:"E",scope:{context:"=",displayedFields:"@",sort:"@"},replace:!0,transclude:!0,templateUrl:b.trustAsResourceUrl(a.basePath+"templates/table.html"),controller:["$scope","$element","$timeout","$document","$window","ODSAPI","DebugLogger","$filter","$http","$compile","$transclude",function(a,b,c,d,e,f,g,h,i,j,k){a.displayedFieldsArray=null,a.page=0,a.resultsPerPage=40,a.fetching=!1,a.records=[],a.working=!0,a.layout=[],a.done=!1;var l,m=b.find(".records-header"),n=b.find(".records-body tbody"),o=m.offset().left,p=0,q=0,r=!1,s=0,t=0,u=100,v=0,w=0,x=Math.random().toString(36).substring(7),y="table-"+x,z="stylesheet-"+x,A=function(b){a.fetching=!0;var c,d={};b?(a.done=!1,a.page=0,a.records=[],c=0):(a.page++,c=a.page*a.resultsPerPage),jQuery.extend(d,a.staticSearchOptions,a.context.parameters,{start:c}),f.records.search(a.context,d).success(function(c){c.records.length||(a.working=!1),a.records=b?c.records:a.records.concat(c.records),a.nhits=c.nhits,a.error="",a.fetching=!1,a.done=(a.page+1)*a.resultsPerPage>=c.nhits}).error(function(b){a.error=b.error,a.fetching=!1})};a.loadMore=function(){a.fetching||a.done||!a.staticSearchOptions||A(!1)},a.isFieldSortable=function(a){return ODS.DatasetUtils.isFieldSortable(a)},a.isAscendingSorted=function(b){return"text"===b.type?b.name===a.context.parameters.sort:"-"+b.name===a.context.parameters.sort},a.isDescendingSorted=function(b){return"text"===b.type?"-"+b.name===a.context.parameters.sort:b.name===a.context.parameters.sort},a.toggleSort=function(b){if(a.isFieldSortable(b)){if(a.context.parameters.sort==b.name)return void(a.context.parameters.sort="-"+b.name);if(a.context.parameters.sort=="-"+b.name)return void(a.context.parameters.sort=b.name);a.context.parameters.sort="text"===b.type?b.name:"-"+b.name}else delete a.context.parameters.sort};var B=!1;k(function(a){B=a.length>0});var C=function(c,d,e){var f,g,i=d[c];if(f=document.createElement("tr"),f.className="record-"+c,"end"===e){var m=b.find(".placeholderBot")[0];m.parentNode.insertBefore(f,m)}else{var n=b.find(".placeholderTop")[0];n.parentNode.insertBefore(f,n.nextSibling)}g=document.createElement("td");var o=document.createElement("div");o.appendChild(document.createTextNode(c+1)),g.appendChild(o),f.appendChild(g);for(var p=0;p<l.length;p++){var q=l[p],r=h("formatFieldValue")(i.fields,q);g=document.createElement("td"),f.appendChild(g);var o=document.createElement("div");g.appendChild(o);var s,t;B?(s=a.$new(!0),s.record=i,s.currentField=q.name,s.currentValue=i.fields[q.name],s.currentFormattedValue=r,t=j("<div inject></div>",k)(s)[0]):(s=a.$new(!1),s.recordFields=i.fields[q.name],q&&"geo_point_2d"===q.type?(s.fieldValue=r,window.ie8?(t=document.createElement("span"),t.title=r,t.innerHTML=r):t=j('<ods-geotooltip width="300" height="300" coords="recordFields">'+r+"</ods-geotooltip>")(s)[0]):q&&"geo_shape"===q.type?(s.fieldValue=h("truncate")(r),window.ie8?(t=document.createElement("span"),t.title=r,t.innerHTML=r):t=j('<ods-geotooltip width="300" height="300" geojson="recordFields">'+r+"</ods-geotooltip>")(s)[0]):(t=document.createElement("span"),t.title=r,t.innerHTML=h("nofollow")(h("prettyText")(r)))),o.appendChild(t)}return f},D=function(a){var c=b[0].getElementsByClassName("record-"+a)[0];c&&c.parentNode.removeChild(c)},E=function(){var c=b.find(".records-body")[0].offsetHeight,d=b.find(".records-body")[0].scrollTop,e=n.find("tr").eq(1).height(),f=b.find(".placeholderTop")[0],g=b.find(".placeholderBot")[0];e?(v=Math.max(Math.floor((d-u*e)/e),0),w=Math.min(Math.ceil((d+c+u*e)/e),a.records.length)):(v=0,w=a.records.length),v=v&&v%2?v+1:v;var h=v-s>0||w-t>0;if(v!==s||w!==t){var i;if(f||(i=document.createElement("tr"),i.className="placeholderTop",i.style.height="0px",n[0].appendChild(i),f=b.find(".placeholderTop")[0]),g||(i=document.createElement("tr"),i.className="placeholderBot",i.style.height="0px",n[0].appendChild(i),g=b.find(".placeholderBot")[0]),!a.layout.length&&a.records.length)for(var j=Math.min(a.records.length,a.resultsPerPage),k=0;j>k;k++)C(k,a.records,"end");else if(h){for(var k=0;v>k;k++)D(k);f.style.height=v*e+"px";for(var l=b[0].getElementsByTagName("tbody")[0].getElementsByTagName("tr"),m=l.length>2,o=m?parseInt(l[l.length-2].className.substr(7),10):v,p=0,k=o+1;w>k;k++)C(k,a.records,"end"),p++;var q=m?$(g).height()-p*e:(a.records.length-w)*e;q=q>0?q:0,g.style.height=q+"px"}else{for(var p=0,k=w+1;k<a.records.length;k++)D(k),p++;var r=a.records.length-(w+1);r=r>=0?r:0,g.style.height=r*e+"px";for(var l=b[0].getElementsByTagName("tbody")[0].getElementsByTagName("tr"),m=l.length>2,x=m?parseInt(l[1].className.substr(7),10):w,p=0,k=x-1;k>=v;k--)C(k,a.records,"begin"),p++;var q=m?$(f).height()-p*e:v*e;q=q>0?q:0,f.style.height=q+"px"}s=v,t=w}};a.$watch("records",function(b,c){b!==c&&(E(),a.computeLayout())});var F=a.$watch("context.dataset",function(b){if(b&&b.datasetid){if(F(),a.displayedFieldsArray=a.displayedFields?a.displayedFields.split(",").map(function(a){return a.trim()}):a.context.dataset.extra_metas&&a.context.dataset.extra_metas.visualization&&angular.isArray(a.context.dataset.extra_metas.visualization.table_fields)&&a.context.dataset.extra_metas.visualization.table_fields.length>0?a.context.dataset.extra_metas.visualization.table_fields:null,!a.context.parameters.sort&&a.context.dataset.extra_metas&&a.context.dataset.extra_metas.visualization&&a.context.dataset.extra_metas.visualization.table_default_sort_field){var c=a.context.dataset.extra_metas.visualization.table_default_sort_field;"-"===a.context.dataset.extra_metas.visualization.table_default_sort_direction&&(c="-"+c),a.context.parameters.sort=c}a.staticSearchOptions={rows:a.resultsPerPage},g.log("table -> dataset watch -> refresh records");var d=h("fieldsForVisualization")(a.context.dataset.fields,"table");l=h("fieldsFilter")(d,a.displayedFieldsArray),A(!0)}},!0);a.$watch("context.parameters",function(c,d){c!==d&&(g.log("table -> searchOptions watch -> refresh records"),a.layout=[],a.working=!0,q=b.find(".records-body")[0].scrollLeft,r=!0,n.empty(),A(!0))},!0);var G=function(){b.find(".records-body").scrollLeft(0),m.css({left:"auto"}),o=b.find(".records-header").offset().left};$(window).on("resize",function(){c(function(){G(),a.layout=[],a.computeLayout()},0)});var H=0;b.find(".records-body").on("scroll",function(){if(this.scrollLeft!==p)m.offset({left:o-this.scrollLeft}),p=this.scrollLeft;else{r=!1;var a=Math.max(Math.floor(b.find(".records-body")[0].scrollTop/n.find("tr").eq(1).height()),0);if(Math.abs(a-H)<u&&a>v)return;H=a,E()}});var I=function(b,c){for(var d="",e=0;e<a.layout.length;e++){var f=e+1,g=c?"max-width: none; ":"";d+="#"+b+" .records-header tr th:nth-child("+f+") > div, #"+b+" .records-body tr td:nth-child("+f+") > div { width: "+a.layout[e]+"px; "+g+"} "}return d};a.computeLayout=function(){var d=b.find(".records-body tbody tr"),e=22;if(!a.layout.length&&a.records.length){if(b.attr("id")||b.attr("id",y),$(".embedded").length){var f=$(window).height()-b.offset().top;b.height(f)}else var f=b.height();b.find(".records-body").height(f-25);var g=n.find("tr").eq(1).height(),h=(d.length-2)*g,i=document.getElementById(z);i&&i.parentNode&&i.parentNode.removeChild(i),b.find(".records-header thead").hide(),b.find(".records-body thead").show();var j=0;angular.forEach(b.find(".records-body thead th > div"),function(b,c){a.layout[c]=$(b).width()+8,j+=a.layout[c]}),a.layout[0]=30;var k=b.find(".records-body table").width(),l=j+e*a.layout.length<b.width();if(l){for(var o=Math.floor(k/a.layout.length),p=k-o*a.layout.length,s=1;s<a.layout.length;s++)a.layout[s]=o-e;a.layout[a.layout.length-1]+=p,b.find(".records-header table").width(h>500?k:"")}var t=document.createElement("style"),u=I(y,l);t.id=z,t.type="text/css",t.styleSheet?t.styleSheet.cssText=u:t.appendChild(document.createTextNode(u)),b[0].appendChild(t),b.find(".records-body thead").hide(),b.find(".records-header thead").show(),r||c(function(){G()},0)}r&&(q||m.css({left:"auto"}),b.find(".records-body")[0].scrollLeft=q),a.layout.length&&(a.working=!1)}}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsTagCloud",["ODSAPI",function(a){function b(a){var b=Math.floor(a.length/2);return a.length%2?a[b].count:(a[b-1].count+a[b].count)/2}function c(a,b){var c=$.grep(a,function(a){return a.count>=b
}),d=$.grep(a,function(a){return a.count<=b}),e=[{count:c.length,min:c[c.length-1].count,max:c[0].count},{count:d.length,min:d[d.length-1].count,max:d[0].count}];return e[0].delta=e[0].max-e[0].min,e[1].delta=e[1].max-e[1].min,e}function d(a,b,c){var d,e=(a.count>=b?c[0].delta:c[1].delta)/2;return d=a.count>=2*e?1:a.count>=e&&a.count<2*e?2:3,d=a.count>=b?d:d+3,a={count:a.count,name:a.name,opacity:((7-d+4)/10+.05).toFixed(2),size:((7-d)/3).toFixed(1),weight:d},a.size=6!==d?a.size:parseFloat(a.size)+.3,a}function e(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a}return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-tag-cloud"><ul><li class="no-data" ng-hide="tags" translate>No data available yet</li><li ng-repeat="tag in tags" class="tag tag{{ tag.weight }}" ng-style="{\'font-size\': tag.size + \'em\', \'opacity\': tag.opacity}"><a ng-href="{{ context.domainUrl }}{{url }}/?refine.{{ facetName }}={{ tag.name }}">{{ tag.name }}</a></li></ul></div>',scope:{context:"=",facetName:"@",max:"@?"},controller:function(f){var g=function(){var g;g="catalog"===f.context.type?a.datasets.search(f.context,{rows:0,facet:f.facetName}):a.records.search(f.context,{rows:0,facet:f.facetName}),g.success(function(a){if(a.facet_groups){f.tags=a.facet_groups[0].facets,f.max&&(f.tags=f.tags.slice(0,f.max));for(var g=b(f.tags),h=0;h<f.tags.length;h++)f.tags[h]=d(f.tags[h],g,c(f.tags,g),f.context.domainUrl);f.tags=e(f.tags)}})};f.$watch("context",function(){("catalog"===f.context.type||"dataset"===f.context.type&&f.context.dataset)&&(f.url="catalog"===f.context.type?"/explore":"/explore/dataset/"+f.context.dataset.datasetid,g())},!0)}}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsTextSearch",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-text-search"><form ng-submit="applySearch()"><input class="searchbox" name="q" type="text" ng-model="searchExpression" placeholder="{{placeholder}}"><button ng-bind="buttonText"></button></form></div>',scope:{placeholder:"@?",button:"@?",context:"="},controller:["$scope","translate",function(a,b){a.buttonText=a.button||b("Search"),a.applySearch=function(){a.context.parameters.q=a.searchExpression}}]}})}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsThemeBoxes",function(){return{restrict:"E",replace:!1,template:'<div class="odswidget odswidget-theme-boxes"><ods-facet-enumerator context="context" facet-name="theme"><a ng-href="{{context.domainUrl}}/explore/?refine.theme={{item.path}}" target="_self" ods-tooltip="{{item.name}} ({{item.count}} jeux de donnes)" ods-tooltip-direction="bottom" style="display: block;"><ods-theme-picto theme="{{item.name}}"></ods-theme-picto></a></div></ods-facet-enumerator></div>',scope:{context:"="}}})}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsThemePicto",["ODSWidgetsConfig","$http",function(a,b){var c={};return{restrict:"E",replace:!0,scope:{theme:"@"},template:'<div class="odswidget odswidget-theme-picto theme-{{getTheme()|themeSlug}}"></div>',link:function(d,e){var f=null,g=!1;a.themes[d.theme]?f=a.themes[d.theme]:(f=a.themes["default"],g=!0),d.getTheme=function(){return g?"default":d.theme};var h=function(a){var b=angular.element(a);f.color?b.css("fill",f.color):e.addClass("colorless"),e.append(b)};if(f){var i=f.img;if(-1===i.indexOf(".svg"))e.append(angular.element('<img src="'+i+'"/>'));else if(c[d.theme])c[d.theme].code?h(c[d.theme].code):c[d.theme].promise.success(function(a){h(a)});else{var j=b.get(i);c[d.theme]={promise:j},j.success(function(a){c[d.theme].code=a,h(a)})}}else;}}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsTimerange",["ModuleLazyLoader",function(a){var b={styles:{container:"rd-container odswidgets-rd-container"},weekStart:1},c=function(a){return"yesterday"===a?moment().subtract("days",1).format("YYYY-MM-DD HH:mm"):"now"===a?moment().format("YYYY-MM-DD HH:mm"):null},d=function(a){return a?moment(a).toISOString().replace(".000Z","Z"):null};return{restrict:"E",replace:!0,scope:{context:"=",timeField:"@?",defaultFrom:"@?",defaultTo:"@?"},template:'<div class="odswidget odswidget-timerange"><span class="odswidget-timerange-from"><span translate>From</span> <input type="text"></span><span class="odswidget-timerange-to"><span translate>to</span> <input type="text"></span></div>',link:function(e,f){var g=f.find("input");angular.isDefined(e.defaultFrom)&&(g[0].value=c(e.defaultFrom),e.from=d(g[0].value)),angular.isDefined(e.defaultTo)&&(g[1].value=c(e.defaultTo),e.to=d(g[1].value)),a("rome").then(function(){rome(g[0],angular.extend({},b,{dateValidator:rome.val.beforeEq(g[1])})).on("data",function(a){e.$apply(function(){e.from=d(a)})}),rome(g[1],angular.extend({},b,{dateValidator:rome.val.afterEq(g[0])})).on("data",function(a){e.$apply(function(){e.to=d(a)})})})},controller:["$scope",function(a){var b=a.timeField,c=function(){a.$watch("[from, to]",function(c){c[0]&&c[1]&&(a.context.parameters.q=b+":["+a.from+" TO "+a.to+"]")},!0)};if(angular.isUndefined(b))var d=a.$watch("context.dataset",function(a){if(a){var e=a.fields.filter(function(a){return"date"===a.type||"datetime"===a.type});e.length>1&&console.log('Warning: the dataset "'+a.datasetid+'" has more than one date or datetime field, the first date or datetime field will be used. You can specify the field to use using the "time-field" parameter.'),0===e.length&&console.log('Error: the dataset "'+a.datasetid+"\" doesn't have any date or datetime field, which is required for the Timerange widget."),b=e[0].name,c(),d()}});else c()}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsTimescale",function(){return{restrict:"E",replace:!0,scope:{context:"=",timeField:"@"},template:'<div class="odswidget odswidget-timescale"><ul><li ng-class="{\'active\': scale == \'everything\' || !scale}"><a href="#" ng-click="selectScale(\'everything\'); $event.preventDefault();" translate>Everything</a></li><li ng-class="{\'active\': scale == \'year\'}"><a href="#" ng-click="selectScale(\'year\'); $event.preventDefault();" translate>Last 12 months</a></li><li ng-class="{\'active\': scale == \'month\'}"><a href="#" ng-click="selectScale(\'month\'); $event.preventDefault();" translate>Last 4 weeks</a></li><li ng-class="{\'active\': scale == \'week\'}"><a href="#" ng-click="selectScale(\'week\'); $event.preventDefault();" translate>Last 7 days</a></li><li ng-class="{\'active\': scale == \'day\'}"><a href="#" ng-click="selectScale(\'day\'); $event.preventDefault();" translate>Last 24 hours</a></li></ul></div>',controller:["$scope",function(a){var b={};if(angular.isUndefined(a.timeField))var c=a.$watch("context",function(d){d&&(angular.isArray(a.context)?angular.forEach(a.context,function(a){b[a.name]={context:a}}):b[a.context.name]={context:a.context},angular.forEach(b,function(b){var c=a.$watch(function(){return b.context.dataset},function(a){if(a){var d=a.fields.filter(function(a){return"date"===a.type||"datetime"===a.type});d.length>1&&console.log('Warning: the dataset "'+a.datasetid+'" has more than one date or datetime field, the first date or datetime field will be used. You can specify the field to use using the "time-field" parameter.'),0===d.length&&console.log('Error: the dataset "'+a.datasetid+"\" doesn't have any date or datetime field, which is required for the Timescale widget."),b.timeField=d[0].name,c()}})}),c())});else var d=a.$watch("context",function(c){c&&(angular.isArray(a.context)?angular.forEach(a.context,function(c){b[c.name]={context:c,timeField:a.timeField}}):b[a.context.name]={context:a.context,timeField:a.timeField},d())});a.selectScale=function(c){if(a.scale=c,"everything"===c)return void angular.forEach(b,function(a){delete a.context.parameters.q});var d=null,e=new Date;"day"===c?e.setDate(e.getDate()-1):"week"===c?e.setDate(e.getDate()-7):"month"===c?e.setMonth(e.getMonth()-1):"year"===c&&e.setFullYear(e.getFullYear()-1),d=e.toISOString(),angular.forEach(b,function(a){a.timeField&&(a.context.parameters.q=a.timeField+'>="'+d+'"')})}}]}})}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsToggleModel",function(){var a=function(a,b,c){a[b]?angular.isArray(a[b])?a[b].indexOf(c)<0&&a[b].push(c):angular.equals(a[b],c)||(a[b]=[a[b],c]):a[b]=c},b=function(a,b,c){a[b]&&(angular.isArray(a[b])?a[b].indexOf(c)>=0&&(1===a[b].length?delete a[b]:a[b].splice(a[b].indexOf(c),1)):angular.equals(a[b],c)&&delete a[b])};return{restrict:"A",scope:{odsToggleModel:"=",odsToggleKey:"@",odsToggleValue:"@"},link:function(c,d){d.on("change",function(d){var e=d.currentTarget.checked;c.$apply(e?function(){a(c.odsToggleModel,c.odsToggleKey,c.odsToggleValue)}:function(){b(c.odsToggleModel,c.odsToggleKey,c.odsToggleValue)})}),c.$watch("odsToggleModel[odsToggleKey]",function(a){a?angular.isArray(a)&&a.indexOf(c.odsToggleValue)>=0?d.prop("checked",!0):angular.equals(a,c.odsToggleValue)?d.prop("checked",!0):d.prop("checked",!1):d.prop("checked",!1)},!0)}}})}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsTopPublishers",["ODSAPI",function(a){return{restrict:"E",replace:!0,template:'<div class="odswidget odswidget-top-publishers"><ul>   <li class="no-data" ng-hide="publishers" translate>No data available yet</li>   <li ng-repeat="publisher in publishers" ng-if="publishers">       <div class="dataset-details">           <div class="name"><a ng-href="{{ context.domainUrl }}/explore/?refine.publisher={{ publisher.path }}" target="_self">{{ publisher.name }}</a></div>           <div class="count"><i class="icon-table"></i> <span translate>Used by</span> {{ publisher.count }} '+"<span ng-pluralize count=\"publisher.count\" translate=\"when\" when=\"{'0': 'dataset', '1': 'dataset', 'other': 'datasets'}\"></span></div>       </div>   </li></ul></div>",scope:{context:"="},controller:["$scope",function(b){var c=function(){a.datasets.facets(b.context,"publisher").success(function(a){b.publishers=a.facet_groups[0].facets.slice(0,5)})};b.$watch("context",function(){c()})}]}}])}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("odsTwitterTimeline",function(){return{restrict:"E",replace:!0,template:'<div class="odswidget"></div>',scope:{widgetId:"@"},link:function(a,b,c){var d='<a class="twitter-timeline" href="https://twitter.com/twitterapi" data-widget-id="'+c.widgetId+'">Tweets</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>';b.append(d)}}})}(),function(){"use strict";var a=angular.module("ods-widgets");a.directive("inject",function(){return{link:function(a,b,c,d,e){var f=a.$new();e(f,function(a){var c=a.clone();c.contents().wrapAll("<div>"),c.contents().length>0&&c.contents().html().trim().length>0&&(b.empty(),b.append(a),b.on("$destroy",function(){f.$destroy()}))})}}}),a.directive("fullClick",function(){return{restrict:"A",link:function(a,b,c){c.fullClick&&b.find("[main-click]").attr("href",c.fullClick),b.click(function(a){if(!$(a.target).is("a,button,[ng-click]")&&0===$(a.target).parents("a,button,[ng-click]").length&&b.find("[main-click]").length)if(document.createEvent){var c=document.createEvent("MouseEvents"),d=a.originalEvent;c.initMouseEvent(d.type,d.bubbles,d.cancelable,window,d.detail,d.screenX,d.screenY,d.clientX,d.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.button,d.relatedTarget),b.find("[main-click]")[0].dispatchEvent(c)}else document.createEventObject&&(window.location=b.find("[main-click]")[0].href)})}}})}();